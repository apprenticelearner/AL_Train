{"version":3,"sources":["components/skill_panel.js","components/panel.js","components/buttons.js","interactions.js","index.js","components/images/Arrowhead-01-128.png","components/images/Arrowhead-Down-01-128.png","serviceWorker.js","tutors/CTAT/CTAT_Tutor.js","App.js","training_handler.js","prior_knowledge.js","eval.js","network_layer.js"],"names":["_react","_interopRequireWildcard","__webpack_require__","_reactNativeWeb","_panel","_interopRequireDefault","deep_equal","require","colorItems","text","items","colors","forEach","item","i","map","t","_","splt","split","length","arr","sep","default","createElement","Text","style","color","textShadowRadius","textShadowColor","_toConsumableArray2","e","reduce","a","b","concat","flat","skill_text_by_action","ButtonPressed","skill","UpdateTextField","match_text_by_action","match","sel","args","Object","entries","acc","kv","push","replace","innerHTML","x","join","SkillPanel","props","_this","_classCallCheck2","this","_possibleConstructorReturn2","_getPrototypeOf2","call","s_skill_set","structure_skills","skill_set","select","starting_selection","state","selected_skill","selected_match","feedback_map","","handleClickSkillItem","bind","_assertThisInitialized2","handleToggleFeedbackButton","initial_select","first_key","keys","id_count","_loop","skills","title","key","index","setState","fnc","rest","callback","evt","_rest","_slicedToArray2","selectSkill","select_callback","interactions_service","send","type","data","_rest2","label","new_feedback_map","console","log","cm","_objectSpread2","prevProps","prevState","s_keys","_this2","View","skillbox_styles","content","liststyles","skill_list","ScrollView","header","TouchableHighlight","underlayColor","sectionHeader","skill_eq","action","where_colors","skill_elem","onPress","daisyChain","backgroundColor","matches","mIndex","match_eq","correct","incorrect","match_container","feedback_button","correct_selected","String","fromCharCode","incorrect_selected","flex","filter","skill_info","showsVerticalScrollIndicator","collapsedHeight","how","where","JSON","stringify","when","which","Component","StyleSheet","create","flexDirection","borderRadius","borderWidth","borderColor","flexBasis","paddingTop","flexWrap","paddingLeft","paddingRight","paddingBottom","fontSize","fontWeight","padding","borderBottomWidth","width","textAlign","display","textIndent","defaultProps","Panel","icons","up","down","expanded","expandable","animation","Animated","Value","event","maxHeight","nativeEvent","layout","height","minHeight","expandedHeight","Math","max","initialValue","finalValue","setValue","timing","toValue","duration","start","icon","styles","container","onLayout","_setMinHeight","toggle","titleContainer","Image","buttonImage","source","body","_setMaxHeight","children","margin","overflow","button","query_text","Buttons","current","interactions_state","Waiting_User_Feedback","action_str","callbacks","button_wrapper1","prompt1","next_button","next_button_text","startstate_button","startstate_button_text","button_wrapper2","prompt2","yes_no","yes_button","yes_button_text","no_button","no_button_text","submit_button","submit_button_text","debugmode","button_wrapper3","nools_button","app","changeInteractionMode","tutor_mode","nools_button_text","generateBehaviorProfile","bottom","_defineProperty2","marginTop","marginBottom","alignItems","flexShrink","justifyContent","position","prompt_text","_xstate","appendStartHistory","assign","start_state_history","context","tutor","get_state","history","stateRecalc","staged_SAI","reward","test_mode","assignFoci","_extends2","foci_of_attention","get_current_foci","saiIsCorrectDone","sai_data","selection","forceUseExample","saiData","skipTraining","examples_only","isFreeAuthor","free_author","checkIsCorrect","noApplicableSkills","logError","error","_kill_this","network_layer","kill_this","toString","printFeedback","nl","action_type","skill_app","skill_applications","toUpperCase","inps","inputs","term_print","clearSkillPanel","skill_panel_props","Applicable Skills","fillSkillPanel","recalcFeedbackMap","match_id","new_label","was_empty","now_empty","assignFeedbackMap","skill_panel","updateFeedbackMap","toggleFeedbackStyle","build_interactions_sm","inh_context","sm","buttons","tutor_sm","interactive","interactive_sm","non_interactive_sm","Machine","services","sendFeedback","Promise","resolve","sendFeedbackExplicit","applyNextExample","attemptStagedSAI","queryApprentice","checkApprentice","actions","assignResponse","response","assignStagedSAI","assignExample","assignAttempt","assignCorrect","assignIncorrect","clearFeedbackData","assignSkillApplications","responses","printEvent","done","training_service","enterSetStartStateMode","exitSetStartStateMode","enterFeedbackMode","exitFeedbackMode","enterFociMode","exitFociMode","enterTutoringMode","exitTutoringMode","displayCorrectness","applyStagedSAI","applySAI","proposeSAI","confirmProposedSAI","clearProposedSAI","generate_nools","guards","get_machine_actions","initial","states","Start","entry","on","Querying_Apprentice","invoke","id","src","onDone","target","cond","onError","exit","Applying_Staged_SAI","Applying_Next_Example","Sending_Feedback","Done","Fail","Setting_Start_State","START_STATE_SET","Waiting_Demonstrate_Only","Waiting_Yes_No_Feedback","SKILL_PANEL_FEEDBACK_NONEMPTY","YES_PRESSED","NO_PRESSED","Waiting_Submit_Feedback","SKILL_PANEL_FEEDBACK_EMPTY","SUBMIT_SKILL_FEEDBACK","STAGE_SAI","TOGGLE_FEEDBACK","FEEBACK_MAP_UPDATE","DEMONSTRATE","GEN_NOOLS","Waiting_Select_Foci","FOCI_DONE","Waiting_User_Attempt","ATTEMPT","Checking_Against_Apprentice","_reactDom","serviceWorker","_CTAT_Tutor","_App","_relaxedJson","tutor_map","ctatttutor","CTAT_Tutor","ctat","safeParse","json","parsed","parse","training_file","urlParams","URLSearchParams","window","location","search","substring","AL_URL","get","OUTER_LOOP_URL","HOST_URL","origin","toLowerCase","use_foci","nools_dir","getWebProps","fetch","then","str","RJSON","training_json","training_file_props","set_params","obj","out","removeEmpty","ReactDOM","render","ref","react_interface","tutorClass","document","getElementById","unregister","module","exports","p","config","navigator","publicUrl","URL","process","href","addEventListener","swUrl","isLocalhost","contentType","headers","status","indexOf","ready","registration","reload","registerValidSW","catch","checkValidServiceWorker","Boolean","hostname","register","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","_reactNativeWebWebview","_classAutobind","queryString","path","$","checkTypes","element","types","ok","classList","contains","relative_pos_cache","color_class_map","EXAMPLE","CORRECT","INCORRECT","HIGHLIGHT","START_STATE","DEFAULT","ctat_webview","React","createRef","highlighted_elements","iframe","init_callback","prob_obj","html","LOAD_SCREEN","reject","HTML_name","lastIndexOf","domain_name","HTML_PATH","isAbsolute","working_dir","BRD_name","free_authoring","qf_exists","undefined","qf","question_file","includes","logging_params","problem_name","dataset_level_name1","dataset_level_type1","SessionLog","Logging","log_service_url","user_guid","agent_name","session_id","custom_fields","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","_ref","value","_ref2","err","return","params","updateContext","graph","commLibrary","hasConfig","uri","onLoad","_triggerWhenInitialized","steps","selections","elm_type","attributes","arguments","elm","iframe_content","attr","setAttribute","getElementsByTagName","appendChild","_this3","frameRef","contentWindow","CTAT","CTATCommShell","commShell","ToolTutor","setTimeout","getGraph","getCommLibrary","CTATConfiguration","_inject_element","rel","flashVars","setParams","deliverymode","CTAT_CORRECT","Base","Tutorable","EventType","CTAT_INCORRECT","CTAT_ACTION","sai","detail","getSelection","getInput","colorElement","start_state_elements","remove","handle_user_set_state","removeEventListener","firstChild","lockElement","handleUserInput","contentEditable","getAction","unlockElement","handleUserExample","CTATSAI","_done_clicked_example","handleUserAttempt","_done_clicked_attempt","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","ele","indx","current_foci","highlightElement","splice","unhighlightElement","unhighlightAll","handle_foci_select","stepId","getTracer","getLastResult","getStepID","_this4","currentElement","shouldSkipTraining","_shouldSkipTraining","handle_ctat_feedback","getTransactionID","_this5","applyHint","getDefaultSAI","sel_elm","incorrect_event","CustomEvent","component","bubbles","cancelable","dispatchEvent","sai_obj","processComponentAction","name","CTATShellTools","findComponent","setEnabled","firstElementChild","colorIndex","add","c","mapping","var_str","elem_str","alert","_i","_arr","getExampleTracer","getBestNextLink","proposed_SAI","clearElement","highlightSAI","stageSAI","comp","executeSAI","sendXML","_ref3","_ref3$encode_relative","encode_relative","_ref3$strip_offsets","strip_offsets","_ref3$use_offsets","use_offsets","_ref3$use_class","use_class","_ref3$use_id","use_id","_ref3$append_ele","append_ele","_ref3$numeric_values","numeric_values","state_array","toArray","state_json","each","idx","offsetParent","dataset","silexId","offsetLeft","offsetTop","offsetWidth","offsetHeight","Number","options","temp","count","rel_objs","elm_list","to_left","to_right","above","below","j","_elm_list$i","a_n","a_obj","_elm_list$j","b_n","b_obj","dist","grab1st","compare2nd","y","rel_obj","sort","originWhitelist","_skill_panel","_buttons","_interactions","_training_handler","_network_layer","_object","ALReactInterface","onInteractionTransition","NetworkLayer","default_props","buttons_props","tutor_props","training_description","agent_description","problem_description","standard_props","d","o1","o2","diff","shallow_diff","wd","tf","interactions_sm","problem_props","training_machine","build_training_sm","interpret","onTransition","onTrainingTransition","subscribe","setTutorMode","setInteractive","setFreeAuthor","ground_truth_path","out_dir","f","t_context","_state","resp","in_list","line","to_json_list","resps","requests","lower_display","Tutor","controls","prompt","ctat_tutor","flexGrow","justifySelf","file_params","agent_params","problem_props_dict","Loading_Training_File","Serving_Training_Sets","Serving_Agents","Creating_Agent","Handling_Prior_Knowledge","Serving_Problems","Waiting_Problem_Load","Training","PROBLEM_DONE","CHANGE_INTERACTION_MODE","All_Done","load_training_file","serve_next_training_set","serve_next_agent","create_agent","createAgent","serve_next_problem","load_problem","handle_prior_knowledge","start_training_interaction","assignAgentId","agent_id","allDone","assignInteractionSM","sendProblemDone","iteratorEmpty","_prior_knowledge","_eval","_randomJs","pick","Random","CTATGuid","s4","floor","random","guid","training_iterator","_asyncToGenerator2","_regenerator","mark","_callee","agent_iterator","wrap","_context","prev","shift","evalJSONFunc","sent","stop","_x","_x2","apply","parseOuterLoopController","problem_set","outer_loop_controller","_callee2","agent_obj","rep_count_str","prior_knowledge","other_data","_context2","unshift","_rep_count","request_history","agent_type","other_agent_data","agent_start_time","Date","_x3","_x4","promise","applyPriorKnowledge","problem_iterator","_next_prob_obj","_callee5","_context5","_ref8","_callee4","fp_clone","_context4","newOuterLoopController","nextProblem","abrupt","_x11","_x12","_callee3","_ref4","_ref5","_ref6","_ref7","_context3","s","_x9","_x10","loadProblem","pass_along_context","withContext","new_context","spec","iter","type_map","_path","bestintersect","pk_iter","cache_folder","cache","cache_content","basename","Error","statusText","train_now","_papaparse","registedFunctions","concatenate","shuffle","sample","glob","from_file","estimate_Pik","gen_pretraining","gen_pivot_table","mirror_students","abs_path","all","g","rez","t0","finish","n","set","glob_key","pattern","m","o","_callee6","_context6","backcast","_callee7","_context7","p_parse_csv","csv","pre_fetch","papa","_x13","_x14","read_afm_table","_callee9","file","_context9","delimiter","dynamicTyping","_callee8","kc_table","stu_table","kc_json","stu_json","_context8","_x28","exact_align","_callee10","fo_err_by_kc","stu_intr","row","prob","table_path","error_table","curve_by_kc","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","r","opps_by_kc","kc","curve","min","minIndex","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","_ref9","_context10","exp","values","t1","t2","t3","Infinity","t4","_callee11","new_out","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_iterator5","_step5","_context11","_callee12","only_attr","only_str","pivot_table","problem_pool","onlys_map","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_iterator6","_step6","any","only_steps","_args12","_context12","Array","from","_callee13","human_transactions","human_afm_stats","pool_agent_error_table","Pik_method","problem_key","kc_model","KCs","maximum","human_problems","human_path_map","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_iterator7","_step7","step_pivot_table","pool_agent_problems","human_prob_seq","url","std","student","seq","new_seq","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_iterator8","_step8","full_path","opp_table","student_id","stu_seq","pretraining","_context13","transaction_file","download","step","sequence","view","pv","t5","method","afm_stats","opportunities","warn","unparse","_callee14","pivot_table_csv","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_iterator9","_step9","path_map","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_iterator10","_step10","kc_model_id","csv_str","_context14","kc_str","step_id","Set","Selection","step_id_set","append","Problem Path","KC","newline","write_file","_callee15","_context15","_callee16","val","_context16","isArray","ignoreKeys","wait","ms","fetch_retry","_args","pow","JSON_HEADERS","Accept","Content-Type","project_id","res","d_list","rhs_id","sendTrainingData","add_skill_info","message","out_data","problems","dir","elapse","start_data","elapse_minutes","toFixed","whatever","completeness_data","kwargs","outer_loop_type","outer_loop_args"],"mappings":"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","file":"static/js/main.258af481.chunk.js","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport { TouchableHighlight,ScrollView,View, Text, StyleSheet } from \"react-native\";\nimport Panel from './panel.js'\nvar deep_equal = require('fast-deep-equal');\n\n\n\nfunction cramBtw(arr,sep){\n  return [...arr].map((e, i) => i < arr.length - 1 ? [e, sep] : [e]).reduce((a, b) => a.concat(b))\n}\n\nfunction colorItems(text, items, colors){\n  text = [text]\n  // for(var item in colorMap) {\n  items.forEach(function(item,i) {\n    text = text.map((t,_) => {\n      if(typeof t == 'string'){\n        let splt = t.split(item)\n        if(splt.length > 1){\n         return cramBtw(splt,<Text style={\n            {\"color\":colors[i],'textShadowRadius':3, 'textShadowColor': colors[i]}}>{item}</Text>);\n         // return cramBtw(splt,<Text style={{\"color\":colorMap[item]}}>{item}</Text>);\n        }\n      }\n      return t;\n    }).flat();\n  });\n  return text;\n}\n\nconst skill_text_by_action ={\n  ButtonPressed: function(skill,colors) {\n    return \"Press Button\"\n  },\n  UpdateTextField: function(skill,colors) {\n    return skill['name'] || skill['how'];\n  }\n\n};\n\nconst match_text_by_action = {\n  UpdateTextField: function(match,colors) {\n    let sel = match['mapping']['?sel']\n    let args =  Object.entries(match['mapping']).reduce(\n      function (acc,kv) {if(kv[0] !== \"?sel\") {acc.push(kv[1])}return acc;},[]);\n    // console.log(sel,args)\n    sel = sel.replace(\"?ele-\",\"\")\n    args = args.map(x => x.replace(\"?ele-\",\"\"))\n    let innerHTML = /*String.fromCharCode(8226) +*/ \"(\" + args.join(\", \") + \"): \" + sel + \"->\" + (match['inputs'] && match['inputs']['value']);\n    innerHTML = colorItems(innerHTML,[sel].concat(args), colors); // innerHTML = cramBtw( innerHTML.split(\"A1\"),<Text style={{\"color\":\"red\"}}>A1</Text>);\n    return innerHTML;\n  },\n  ButtonPressed: function(match,colors) {\n    return \"Press: \" + match['mapping']['?sel'].replace(\"?ele-\",\"\");\n  }                          \n}\n\n\nclass SkillPanel extends Component{\n  constructor(props){\n        super(props);\n\n\n        this.s_skill_set = this.structure_skills(props.skill_set)\n        \n        var select = this.starting_selection();\n        // const selected_skill = 0;\n        this.state = {\n          selected_skill: select,\n          selected_match: select,\n          feedback_map:{},\n          s_skill_set : {\"\" : []}\n        };\n      this.handleClickSkillItem = this.handleClickSkillItem.bind(this)\n      this.handleToggleFeedbackButton = this.handleToggleFeedbackButton.bind(this)\n  }\n\n  starting_selection(){\n    if(this.props.initial_select == \"first\"){\n      let first_key = Object.keys(this.s_skill_set)[0];\n      return first_key==null ? null : this.s_skill_set[first_key][0];\n    }\n\n  }\n\n  structure_skills(skill_set){\n    const s_skill_set = {}\n    var id_count = 0;\n    for (var title in skill_set) {\n      let skills = {};\n\n      for (var i in skill_set[title]){\n        var skill = skill_set[title][i]\n        if(!(skill['how'] in skills)){\n          \n          skills[skill['how']] = skill;\n          skills[skill['how']]['matches'] = []\n          // delete skills[skill['how']][\"mapping\"]\n\n        }\n        skill['_id'] = id_count++;\n        skills[skill['how']]['matches'].push(skill);\n\n      // console.log(skills)\n      s_skill_set[title] = Object.keys(skills).map((key,index)=>skills[key]);\n      }\n\n    }\n    return s_skill_set\n    // console.log(skill_set)\n  }\n\t\n\n  selectSkill(skill,match){\n    if(!match){\n      match = skill\n    }\n    this.setState({selected_skill: skill,\n                    selected_match: match})     \n  }\n\n  daisyChain(fnc, rest,callback){\n    return (evt) => {fnc(evt,rest,callback)};\n  }\n  handleClickSkillItem(evt,rest,callback){\n    const [skill,match] = rest;\n    // console.log(title,index,match)\n    // this.selectSkill(this.props.skill_set[title][index],match)\n    this.selectSkill(skill,match)\n    // console.log(this.props.select_callback)\n    if(this.props.select_callback){\n      this.props.interactions_service.send({type :\"STAGE_SAI\",data : match || skill})\n      // this.props.select_callback(match || skill)   \n    }\n    if(callback){\n      callback(rest)\n    }\n    \n  }\n  handleToggleFeedbackButton(evt,rest){\n    const [skill,match,label] = rest;\n    this.props.interactions_service.send(\n        {type: \"TOGGLE_FEEDBACK\",skill:skill, match:match, label:label})\n    // console.log(skill)\n    // console.log(match)\n    // console.log(label)\n    // let match_id = match[\"_id\"];\n    // // console.log(match[\"_id\"])\n    // // console.log(this.state.feedback_map)\n    // let new_label = (this.state.feedback_map[match_id]\n    //        && label === this.state.feedback_map[match_id]) ? null : label;\n    \n    // let new_feedback_map = {...this.state.feedback_map};\n    // if(new_label === null){\n    //   delete new_feedback_map[match_id];\n    // }else{\n    //   new_feedback_map[match_id] = new_label;\n    // }\n  }\n\n  updateFeedbackMap(new_feedback_map){\n    \n    // let was_empty = Object.keys(this.state.feedback_map).length === 0\n    // let now_empty = Object.keys(new_feedback_map).length === 0\n    // if(!was_empty && now_empty){\n    //   console.log(\"EMPTY\")\n    //   this.props.interactions_service.send(\"SKILL_PANEL_FEEDBACK_EMPTY\")\n    // }else if(was_empty && !now_empty){\n    //   console.log(\"NOT EMPTY\")\n    //   this.props.interactions_service.send(\"SKILL_PANEL_FEEDBACK_NONEMPTY\")\n    // }\n\n    this.setState({feedback_map : new_feedback_map});\n\n    console.log(new_feedback_map)\n\n    // if(this.props.correctness_callback){\n    //   this.props.correctness_callback(match || skill,new_label)\n    // }\n  }\n\n  queuedSkillApplicationFeedback(){\n    var feedback_queue = {}\n    let cm = {...this.state.feedback_map}\n    for (var key in cm) {\n      cm[key] = cm[key] === \"correct\" ? 1 :-1 \n    }\n    return cm\n  }\n\n  componentDidUpdate(prevProps, prevState){\n    if(!deep_equal(prevProps.skill_set,this.props.skill_set)){\n      let s_skill_set = this.structure_skills(this.props.skill_set)\n      this.setState({\n        feedback_map: {},\n        s_skill_set : s_skill_set\n      })\n\n      let s_keys = Object.keys(s_skill_set)\n      if(s_keys.length > 0){// && !this.state.selected_skill || !this.state.selected_skill){\n        let select = s_skill_set[s_keys[0]][0]\n        this.setState({\n            selected_skill: select,\n            selected_match: select,\n        })\n      }else{\n        this.setState({\n            selected_skill: null,\n            selected_match: null,\n        })\n      }\n    }\n    // }\n  }\n\n\n\trender(){\n    // console.log(this.s_skill_set)\n    // this.s_skill_set = this.structure_skills(this.props.skill_set)\n    \n    \n\n    // this.state = \n\t\treturn (\n\t\t    <View style={skillbox_styles.content}>\n\t\t      \n          <View style={liststyles.skill_list}>\n          <ScrollView>\n            {Object.keys(this.state.s_skill_set).map((title, index) => {\n              let header = <TouchableHighlight underlayColor=\"#fff\" >\n                 <Text style={liststyles.sectionHeader}>{title}</Text>\n              </TouchableHighlight> \n              // let itemStyle = liststyles.item;\n              let rest = this.state.s_skill_set[title].map((skill, index) => {\n                  const skill_eq = this.state.selected_skill && this.state.selected_skill['_id']===skill['_id'];\n                  // console.log(skill_eq)\n                  // console.log(\"IS\",itemStyle)\n                  // console.log(\"EQ\",eq, index, (eq ? itemStyle.selectColor : itemStyle.backgroundColor))\n                  let innerHTML = (skill_text_by_action[skill.action] || skill_text_by_action[\"UpdateTextField\"])(skill,this.props.where_colors)\n                  let skill_elem = <TouchableHighlight underlayColor=\"#f1f1f1\"\n                             onPress={ this.daisyChain(this.handleClickSkillItem,[skill],\n                                                       skill['callback']) } >\n                            <Text style={[liststyles.item, skill_eq && liststyles.selected_skill]} \n                            backgroundColor={\"#ff00ffff\"}>{\n                              innerHTML}</Text>\n                        </TouchableHighlight>\n                  let matches = [];\n                  if(\"matches\" in skill){\n                      // console.log(skill[\"matches\"])\n                      matches = skill[\"matches\"].map((match,mIndex) => {\n                        if('mapping' in match){\n                          const match_eq = this.state.selected_match && this.state.selected_match['_id']===match['_id'];\n                          \n                          // let sel = match['mapping']['?sel']\n                          // let args =  Object.entries(match['mapping']).reduce(\n                          //   function (acc,kv) {if(kv[0] != \"?sel\") {acc.push(kv[1])}return acc;},[]);\n                          // console.log(sel,args)\n                          // sel = sel.replace(\"?ele-\",\"\")\n                          // args = args.map(x => x.replace(\"?ele-\",\"\"))\n                          // let innerHTML = String.fromCharCode(8226) + \"(\" + args.join(\", \") + \"):\" + sel + \"->\" + (match['inputs'] && match['inputs']['value']);\n                          // innerHTML = colorItems(innerHTML,{\"B1\":'red',\"A1\":'green'}); // innerHTML = cramBtw( innerHTML.split(\"A1\"),<Text style={{\"color\":\"red\"}}>A1</Text>);\n                          // console.log(match_text_by_action,match.action)\n                          let innerHTML = (match_text_by_action[match.action] || match_text_by_action[\"UpdateTextField\"])(match,this.props.where_colors)\n                          let correct = this.state.feedback_map[match[\"_id\"]] === \"correct\";\n                          let incorrect = this.state.feedback_map[match[\"_id\"]] === \"incorrect\";\n                          // console.log(this.state.feedback_map)\n                          let match_view = <View style={liststyles.match_container}> \n\n                            <TouchableHighlight underlayColor=\"#919191\"  \n                            onPress = {this.daisyChain(this.handleToggleFeedbackButton,[skill,match,\"correct\"])}\n\n                                 // onPress={ this.daisyChain(this.handleClickSkillItem,[skill,match], \n                                                           // match['callback'])} >\n                                                           >\n                                <Text style={[liststyles.feedback_button, correct && liststyles.correct_selected]}>{\n                                  String.fromCharCode(10004)\n                                  // innerHTML\n                                  // String.fromCharCode(8226)+ \" \"+Object.values(match['mapping'] || {}).map(.join(\", \")\n                                }</Text>\n                            </TouchableHighlight>\n                            <TouchableHighlight underlayColor=\"#919191\"  \n                            onPress = {this.daisyChain(this.handleToggleFeedbackButton,[skill,match,\"incorrect\"])}\n                                 // onPress={ this.daisyChain(this.handleClickSkillItem,[skill,match], \n                                                           // match['callback'])} >\n                                                           >\n                                <Text style={[liststyles.feedback_button, incorrect && liststyles.incorrect_selected]}>{\n                                  String.fromCharCode(10006)\n                                  // innerHTML\n                                  // String.fromCharCode(8226)+ \" \"+Object.values(match['mapping'] || {}).map(.join(\", \")\n                                }</Text>\n                            </TouchableHighlight>\n\n                            \n                            <TouchableHighlight underlayColor=\"#919191\"\n                                  style={{'flex': 1}}\n                                 onPress={ this.daisyChain(this.handleClickSkillItem,[skill,match], \n                                                           match['callback'])} >\n                                <Text style={[liststyles.match,skill_eq && match_eq && liststyles.selected_match]}>{\n                                  innerHTML\n                                  // String.fromCharCode(8226)+ \" \"+Object.values(match['mapping'] || {}).map(.join(\", \")\n                                }</Text>\n                            </TouchableHighlight>\n                          </View>\n\n                          // let match_view = <View> {match_elem} </View>\n                          // console.log(typeof match_elem)\n                          return match_view;\n                        }else{\n                          return null;\n                        }\n                      })\n                  }\n                  matches = matches.filter(x => x != null); //remove undefinded\n                  return [skill_elem].concat(matches);\n                })\n              // console.log(title)\n              // console.log(header)\n              // console.log(rest)\n              return [header].concat(rest)\n              })\n            }\n          </ScrollView>\n\n            \n\n          </View>\n\n          \n\t\t      <ScrollView style={liststyles.skill_info}\n\t\t                 showsVerticalScrollIndicator={true}\n\t\t                 \n\t\t                 // contentInset= {{top: 20, left: 20, bottom: 0, right: 20}}\n\t\t                 >\n\t\t        <Panel title=\"How\"\n\t\t        \t   collapsedHeight={this.props.collapsedHeight.how}>\n\t\t          <Text>{this.state.selected_skill && this.state.selected_skill.how}</Text>\n\t\t        </Panel>\n\t\t        <Panel title=\"Where\"\n\t\t        \t   collapsedHeight={this.props.collapsedHeight.where}>\n\t\t          <Text>{this.state.selected_skill && JSON.stringify(this.state.selected_skill.where, null, 2)}</Text>\n\t\t        </Panel>\n\t\t        <Panel title=\"When\"\n\t\t        \t   collapsedHeight={this.props.collapsedHeight.when}>\n\t\t          <Text>{this.state.selected_skill && this.state.selected_skill.when}</Text>\n\t\t        </Panel>\n\t\t        <Panel title=\"Which\"\n\t\t        \t   collapsedHeight={this.props.collapsedHeight.which}>\n\t\t          <Text>{this.state.selected_skill && this.state.selected_skill.which}</Text>\n\t\t        </Panel>\n\n\t\t      </ScrollView>\n          \n\n\n\n\n\t\t    </View>  \n\t\t  );\n\t}\n\n}\n\nconst skillbox_styles = StyleSheet.create({\n  content: {\n    // \"display\": \"flex\",\n    flex : 1,\n\n    // \"height\" : \"100%\",\n    // \"flexDirection\":\"row-reverse\",\n    \"flexDirection\":\"row\",\n    \n    backgroundColor: \"#F5FCFF\",\n    // \"width\":\"100%\",\n    borderRadius: 4,\n    borderWidth: 0.5,\n    borderColor: '#d6d7da',\n    \n  },\n});\n\nconst liststyles = StyleSheet.create({\n  skill_list: {\n   flexBasis : 250,\n   paddingTop: 10,\n  },\n  skill_info: {\n   flex: 1,\n   paddingTop: 10,\n  },\n  sectionHeader: {\n    flexWrap: 'wrap',\n    paddingTop: 6,\n    paddingLeft: 10,\n    paddingRight: 10,\n    paddingBottom: 2,\n    fontSize: 15,\n    fontWeight: 'bold',\n    backgroundColor: \"'rgba(247,247,247,1.0)'\",\n  },\n  selected_skill:{\n    backgroundColor: \"#93e4ec\",\n  },\n  \n\n  item: {\n    flexWrap: 'wrap',\n    padding: 4,\n    paddingLeft: 6,\n    fontSize: 16,\n    borderBottomWidth: 1,\n    borderColor: 'gray',\n    backgroundColor: \"'rgba(247,0,0,0.0)'\",\n  },\n  feedback_button:{\n    fontSize: 20,\n    width:27,\n    textAlign:\"center\",\n    borderWidth:.1,\n    borderColor: 'lightgray',\n\n  },\n  incorrect_selected:{\n    // underlayColor:\"#00FF00\",\n    backgroundColor: \"red\",\n  },\n  correct_selected:{\n    backgroundColor: \"limegreen\",\n  },\n  match_container:{\n    display: 'flex',\n    flexDirection: 'row',\n    borderBottomWidth: 1,\n    borderColor: 'gray',\n\n  },\n  match: {\n    flex: 1,\n    flexWrap: 'wrap',\n    // justifySelf: 'stretch',\n    padding: 3,\n    textIndent:5,\n    fontSize: 15,\n    backgroundColor: \"'rgba(252,252,252,1.0)'\",\n\n  },\n  selected_match:{\n    backgroundColor: \"#b3e8ff\",\n  },\n})\n\n// function no_op(){\n// \tvoid 0;\n// }\n\nSkillPanel.propTypes = {\n  collapsedHeight: PropTypes.object,\n  select_callback: PropTypes.func,\n}\n\nSkillPanel.defaultProps = {\n  collapsedHeight: {\"how\": 40,\n\t\t\t\t\t\"where\": 90,\n\t\t\t\t\t\"when\": 90,\n\t\t\t\t\t\"which\": 40,\n\t\t\t\t\t},\n   //\"darkorchid\", \"#feb201\",   \"#ff884d\", \"#52d0e0\", \"#e44161\",  \"#2f85ee\", \"#562ac6\", \"#cc24cc\"\n   where_colors: [  \"darkorchid\",  \"#ff884d\",  \"#52d0e0\", \"#feb201\",  \"#e44161\", \"#ed3eea\", \"#2f85ee\",  \"#562ac6\", \"#cc24cc\"],\n   select_callback: () => {}\n}\n\nexport default SkillPanel;\n\n\n\n            /*<ScrollView >\n            \n                <SectionList \n                  sections={this.props.sections}\n\n                  renderSectionHeader={({section}) =>\n                  <TouchableHighlight underlayColor=\"#f1f1f1\" >\n                   <Text style={liststyles.sectionHeader}>{section.title}</Text>\n                  </TouchableHighlight>\n                  }\n                  renderItem={({item}) => \n                  <TouchableHighlight underlayColor=\"#f1f1f1\"\n                    onPress={this.props.clicky_callback}>\n                   <Text style={liststyles.item}>{item}</Text>\n                  </TouchableHighlight>\n                  }\n\n                  keyExtractor={(item, index) => index}\n                />\n            \n            </ScrollView>*/","import React, { Component } from 'react'\nimport {StyleSheet,Text,View,Image,TouchableHighlight,Animated} from 'react-native'; //Step 1\n\nclass Panel extends Component{\n    constructor(props){\n        super(props);\n\n        this.icons = {     //Step 2\n            'up'    : require('./images/Arrowhead-01-128.png'),\n            'down'  : require('./images/Arrowhead-Down-01-128.png')\n        };\n\n        this.state = {       //Step 3\n            title       : props.title,\n            expanded    : false,\n            expandable  : true,\n            animation   : new Animated.Value(props.collapsedHeight)\n        };\n    }\n\n    _setMaxHeight(event){\n        // console.log(\"maxheight\",event.nativeEvent.layout.height)\n        this.setState({\n            maxHeight   : event.nativeEvent.layout.height,\n            expandable  : event.nativeEvent.layout.height > this.props.collapsedHeight\n        });\n\n    }\n\n    _setMinHeight(event){\n        \n        // console.log(\"minheight\",minHeight,this.props.collapsedHeight)\n        this.setState({\n            minHeight   : event.nativeEvent.layout.height\n        });\n    }\n\n    toggle(){\n        //Step 1\n        // let initialValue, finalValue\n\n        let expandedHeight = Math.max(this.state.maxHeight + this.state.minHeight,this.props.collapsedHeight);\n        let collapsedHeight = Math.max(this.state.minHeight,this.props.collapsedHeight);\n        \n        let initialValue    = this.state.expanded? expandedHeight:collapsedHeight,\n            finalValue      = this.state.expanded? collapsedHeight:expandedHeight;\n        // console.log(finalValue)\n        this.setState({\n            expanded : !this.state.expanded  //Step 2\n        });\n\n        this.state.animation.setValue(initialValue);  //Step 3\n        Animated.timing(     //Step 4\n            this.state.animation,\n            {\n                toValue: finalValue,\n                duration: 50\n            }\n        ).start();  //Step 5\n    }\n\n\n    render(){\n        let icon = this.icons['down'];\n\n        if(this.state.expanded){\n            icon = this.icons['up'];   //Step 4\n        }\n\n        //Step 5\n        return ( \n            <Animated.View\n                style={[styles.container,{height: this.state.animation}]}>\n                <TouchableHighlight \n                    underlayColor=\"#f1f1f1\"\n                    onLayout={this._setMinHeight.bind(this)}\n                    onPress={this.state.expandable ? this.toggle.bind(this):null}> \n                    <View style={styles.titleContainer}>\n                        \n                        <Text style={styles.title}> {this.props.title} </Text> \n\n                    { this.state.expandable &&\n                        <Image\n                            style={styles.buttonImage}\n                            source={icon}\n                        ></Image>\n                    }\n                        \n                    </View>\n                </TouchableHighlight>\n                \n                <View style={styles.body} onLayout={this._setMaxHeight.bind(this)}> \n                    {this.props.children}\n                </View>\n\n            </Animated.View>\n        );\n    }\n}\n\n\nvar styles = StyleSheet.create({\n    container   : {\n        backgroundColor: '#fff',\n        margin:2,\n        overflow:'hidden'\n    },\n    titleContainer : {\n        flexDirection: 'row'\n    },\n    title       : {\n        flex    : 1,\n        padding : 2,\n        color   :'#2a2f43',\n        fontWeight:'bold'\n    },\n    button      : {\n\n    },\n    buttonImage : {\n        width   : 30,\n        height  : 25\n    },\n    body        : {\n        padding     : 5,\n        paddingTop  : 0,\n        paddingBottom  : 20,\n\n    }\n});\n\nexport default Panel;","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport { TouchableHighlight,ScrollView,View, Text, StyleSheet } from \"react-native\";\nimport Panel from './panel.js'\nvar deep_equal = require('fast-deep-equal');\n\n\n// import { useMachine } from '@xstate/react';\n\n\nvar text_by_mode = {\"choose_foci\": \"Select any interface elements that were used to compute this result.\",\n                    \"set_start\": \"Set the start state.\",\n                    \"press_next\": \"Press next to continue.\",\n                    \"demonstrate\" : \"Demonstrate the next step.\"\n                    }\n\n// function gen_query_text(){\n//   let h = <Text style={{\"color\":\"darkorchid\",'textShadowRadius':3, 'textShadowColor': \"darkorchid\"}}>{\"highlighted\"}</Text>\n//   return [\"Or specify if the \", h ,\" input is correct for the next step.\"]\n// }\nvar h = <Text style={{\"color\":\"darkorchid\",'textShadowRadius':3, 'textShadowColor': \"darkorchid\"}}>{\"highlighted\"}</Text>\nvar query_text = [\"Or specify if the \", h ,\" input is correct for the next step.\"]\n\n\nclass Buttons extends Component{\n  constructor(props){\n        super(props);\n        \n        // props.mode = \"feedback\"\n        // props.yes_no = false\n        // props.current\n  }\n\n  // componentDidMount() {\n  //   this.service.start();\n  // }\n\n  // componentWillUnmount() {\n  //   this.service.stop();\n  // }\n\n\n\trender(){ \n    // const current = this.props.interactions_state || {\"value\" : \"\"};\n    // const current = this.props.interactions_state || {\"value\" : \"\"};\n    // var service = this.props.interactions_service\n    var current = this.props.interactions_state\n    // console.log(\"CURRENT_MCGIGGER\",this.props.interactions_state)\n    const matches = (x) => current && current.matches ? current.matches(x) : deep_equal(x , {\"Waiting_User_Feedback\":\"Waiting_Yes_No_Feedback\"});\n    console.log(\"props\",this.props)\n    // const matches = (x) => current.matches(x)\n    const send  = (action_str) => {\n      console.log(action_str)\n      console.log(this.props.callbacks)\n      if(this.props.callbacks && action_str in this.props.callbacks){\n        this.props.callbacks[action_str]();\n      }\n      this.props.interactions_service.send(action_str);\n    }\n\n\t\treturn (\n          <View style={styles.container}>\n            <View style={styles.button_wrapper1}>\n              <Text style={styles.prompt1}> \n              {matches(\"Setting_Start_State\") &&\n               \"Set the start state.\"}\n              {(matches(\"Waiting_User_Feedback\")  || matches({\"Waiting_User_Feedback\":\"Waiting_Yes_No_Feedback\"})) &&\n               \"Demonstrate the next step.\"}\n              {matches(\"Explantions_Displayed\") &&\n               \"Press next to continue. Or demonstrate the next step.\"}\n              {matches(\"Waiting_Select_Foci\") &&\n               \"Select any interface elements that were used to compute this result.\"}\n              {matches(\"Waiting_User_Attempt\") &&\n               \"TUTOR MODE\"}\n              \n              </Text>\n\n              {matches(\"Waiting_Select_Foci\") &&\n              <TouchableHighlight style={styles.next_button} underlayColor=\"#CCCCCC\"\n                                onPress={() => send('FOCI_DONE')}>\n               <Text style={styles.next_button_text}>{\"Next\"}</Text>\n              </TouchableHighlight>\n              } \n\n              {matches(\"Explantions_Displayed\") &&\n              <TouchableHighlight style={styles.next_button} underlayColor=\"#CCCCCC\"\n                                onPress={() => send('NEXT_PRESSED')}>\n               <Text style={styles.next_button_text}>{\"Next\"}</Text>\n              </TouchableHighlight>\n              }\n\n              {matches(\"Setting_Start_State\") &&\n              <TouchableHighlight style={styles.startstate_button} underlayColor=\"#CCCCCC\"\n                                onPress={ ()=> send(\"START_STATE_SET\")}>\n               <Text style={styles.startstate_button_text}>{\"Start State Done\"}</Text>\n              </TouchableHighlight>\n              }\n            </View>\n\n            \n            {(matches({\"Waiting_User_Feedback\":\"Waiting_Yes_No_Feedback\"})\n             || matches({\"Waiting_User_Feedback\":\"Waiting_Submit_Feedback\"})) &&\n\n            <View style={styles.button_wrapper2}>\n              <Text style={styles.prompt2}> \n              {matches({\"Waiting_User_Feedback\":\"Waiting_Yes_No_Feedback\"}) && query_text}\n              {matches({\"Waiting_User_Feedback\":\"Waiting_Submit_Feedback\"}) &&\n                \"Or press submit to send the feedback from the skill panel.\"}\n              </Text>\n              {matches({\"Waiting_User_Feedback\":\"Waiting_Yes_No_Feedback\"}) &&\n              <View style={styles.yes_no}>\n                <TouchableHighlight style={styles.yes_button} underlayColor=\"#CCCCCC\" \n                                  onPress={() => send('YES_PRESSED')}>\n                 <Text style={styles.yes_button_text}>{\"YES\"}</Text>\n                </TouchableHighlight>\n                <TouchableHighlight style={styles.no_button} underlayColor=\"#CCCCCC\" \n                                  onPress={() => send('NO_PRESSED')}>\n                 <Text style={styles.no_button_text}>{\"NO\"}</Text>\n                </TouchableHighlight>\n              </View>\n              }\n              {matches({\"Waiting_User_Feedback\":\"Waiting_Submit_Feedback\"}) &&\n                <TouchableHighlight style={styles.submit_button} underlayColor=\"#CCCCCC\" \n                                  onPress={() => send('SUBMIT_SKILL_FEEDBACK')}>\n                 <Text style={styles.submit_button_text}>{\"Submit\"}</Text>\n                </TouchableHighlight>\n              }\n            </View>\n            }\n            \n            {!this.props.debugmode && \n            \n            <View style={styles.button_wrapper3}>\n              {/*<TouchableHighlight style={styles.nools_button} underlayColor=\"#CCCCCC\" \n                                  onPress={() => send(\"GEN_NOOLS\")}>\n               <Text style={styles.nools_button_text}>{\"Generate Nools\"}</Text>\n              </TouchableHighlight>\n            */}\n              <TouchableHighlight style={styles.nools_button} underlayColor=\"#CCCCCC\" \n                                  onPress={() => this.props.app.changeInteractionMode({tutor_mode:!this.props.tutor_mode})}>\n               <Text style={styles.nools_button_text}>{(!this.props.tutor_mode && \"Tutor Mode\") || \"Train Mode\"}</Text>\n              </TouchableHighlight>\n              <TouchableHighlight style={styles.nools_button} underlayColor=\"#CCCCCC\" \n                                  onPress={()=>this.props.app.generateBehaviorProfile()}>\n               <Text style={styles.nools_button_text}>{\"Gen bProfile\"}</Text>\n              </TouchableHighlight>\n\n            </View>\n            }\n\n            {this.props.debugmode && \n            <View style={styles.button_wrapper3}>\n              <View style={{display:'absolute',bottom:0,flexDirection:\"row\"}}>\n                <TouchableHighlight style={[styles.yes_button,{height:20}]} underlayColor=\"#CCCCCC\"\n                      onPress={() => send('DEMONSTRATE')}>\n                     <Text style={{fontSize : 10}}>{\"Demonstrate\"}</Text>\n                </TouchableHighlight>\n                <TouchableHighlight style={[styles.yes_button,{height:20}]} underlayColor=\"#CCCCCC\" onPress={ ()=>{}}\n                      onPress={() => send('DONE')}>\n                     <Text style={{fontSize : 10}}>{\"Done\"}</Text>\n                </TouchableHighlight>\n                <TouchableHighlight style={[styles.yes_button,{height:20}]} underlayColor=\"#CCCCCC\" onPress={ ()=>{}}\n                      onPress={() => send('APPLICABLE_SKILLS_RECIEVED')}>\n                     <Text style={{fontSize : 10}}>{\"Req recieved\"}</Text>\n                </TouchableHighlight>                \n              </View>\n            </View>\n          }\n        </View>\n\t\t  );\n\t}\n\n}\n\nconst styles = StyleSheet.create({\n\n  \"container\": {\n    flex : 1,\n    flexDirection : \"column\",\n    // justifyContent: \"spaceBetween\",\n    // marginBottom : 40\n    // display: \"flex\",\n    // flexWrap: \"wrap\",\n    // \"height\" : \"100%\",\n  },\n\n  \"prompt1\" : {\n    fontSize: 20,\n    \"textAlign\":\"center\",\n    // marginBottom : 20,\n    margin : 3,\n    flexWrap: \"wrap\",\n  },\n\n  \"prompt2\" : {\n    fontSize: 20,\n    \"textAlign\":\"center\",\n    margin : 7,\n    marginTop : 25,\n    marginBottom : 12,\n    flexWrap: \"wrap\",\n  },\n\n  \"button_wrapper1\":{\n    display:\"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n\n    // flexBasis : \"40%\",\n    // \"pointerEvents\": \"none\",\n\n  },\n\n  \"button_wrapper2\":{\n    // justifyContent: \"spaceBetween\",\n    display:\"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n    // flexBasis : \"40%\",\n    flexShrink: 1,\n    // marginBottom : 70,\n    // \"pointerEvents\": \"none\",\n\n  },\n\n  \"button_wrapper3\":{\n\n    display:\"flex\",\n    flexDirection: \"row\",\n    justifyContent: \"space-around\",\n\n    // position: \"absolute\",\n    // bottom: 5,\n    padding: 5,\n\n    \n    // alignItems: \"center\",\n    // flexBasis : \"20%\",\n    marginTop: \"auto\",\n    // marginBottom: \"auto\",\n    \n    \n    // justifySelf: \"flex-end\",\n    // \"pointerEvents\": \"none\",\n\n  },\n\n  \"yes_no\":{\n\n    display:\"flex\",\n    flexDirection: \"row\",\n    // justifyContent: \"space-between\"\n    // marginVertical: 10\n\n  },\n\n  \"nools_button\" : {\n    // position: \"absolute\",\n    // bottom: 5,\n    padding: 5,\n    // \"top\":100,\n    \"width\":100,\n    \"backgroundColor\": \"#999999\",\n    // justifySelf: \"bottom\",\n    borderRadius: 5,\n    \n  },\n\n  \"nools_button_text\" : {\n    // \"fontSize\":18,\n    \"textAlign\":\"center\",\n\n  },\n\n  \"startstate_button\" : {\n    \"position\": \"relative\",\n    \"width\":200,\n    // \"fontSize\":18,\n    \"backgroundColor\": \"#4CAF50\",\n     borderRadius: 5,\n     padding: 5,\n    // \"pointerEvents\": auto;\n  },\n  \"startstate_button_text\" : {\n    \"fontSize\":20,\n    \"textAlign\":\"center\",\n  },\n\n  \"yes_button\" :{\n    \"width\":80,\n    \"backgroundColor\": \"#4CAF50\",\n    borderRadius: 6,\n    margin: 8,\n    padding: 4,\n    // \"pointerEvents\": auto;\n  },\n  \"yes_button_text\" : {\n    \"fontSize\":30,\n    \"textAlign\":\"center\",\n  },\n\n   \"no_button\" :{\n    \"width\":80,\n    \"backgroundColor\": \"#f44336\",\n    borderRadius: 6,\n    margin: 8,\n    padding: 4,\n    // \"pointerEvents\": auto;\n  },\n\n  \"no_button_text\" : {\n    \"fontSize\":30,\n    \"textAlign\":\"center\",\n  },\n\n  \"next_button\" : {\n    // display: \"relative\",\n    // bottom: 0,\n    width:100,\n    backgroundColor: \"#4CAFFF\",\n    borderRadius: 6,\n    margin: 10,\n    padding: 5,\n    // \"pointerEvents\": auto;\n  },\n\n  \"next_button_text\" : {\n    \"fontSize\":35,\n    \"textAlign\":\"center\",\n  },\n\n  \"submit_button\" : {\n    // display: \"relative\",\n    // bottom: 0,\n    width:150,\n    backgroundColor: \"#4CAFFF\",\n    borderRadius: 6,\n    margin: 10,\n    padding: 5,\n    // \"pointerEvents\": auto;\n  },\n\n  \"submit_button_text\" : {\n    \"fontSize\":30,\n    \"textAlign\":\"center\",\n  },\n\n  \"prompt_text\" :{\n    /*display:flex;*/\n    \"textAlign\":\"center\",\n    \"fontSize\":25,\n\n  }, \n\n});\n\n\nexport default Buttons;\n","import { Machine, assign, interpret, send } from \"xstate\";\n\n// const sendFeedback = (context,event,explicit=false) => {\n// \tif(event.response_type == \"CORRECT\"){\n// \t\tcontext.network_layer.sendFeedback(context,event,1,explicit)\n// \t}else if(event.response_type == \"INCORRECT\"){\n// \t\tcontext.network_layer.sendFeedback(context,event,-1,explicit)\n// \t}else if(event.response_type == \"NO_RESPONSE\"){\n// \t\tcontext.network_layer.sendFeedback(context,event,0,explicit)\n// \t}\n// }\n\n// const post_next_example = (context,event) => {\n\n// }\n\n// const queryApprentice = () => {};\n// const post_next_example = () => {};\n// const apply_sai = () => {};\n// const queryApprentice = () => {};\n// const queryApprentice = () => {};\n// const queryApprentice = () => {};\n// const queryApprentice = () => {};\n\n// function apply_skill_application(context,event){\n// \tcontext.tutor.apply_skill_application()\n// }\n\n// function apply_next_example(context,event){\n// \tconst tutor = context.tutor\n// \tvar sai = tutor.getDefaultSAI()\n// \tvar data = {state: context.state, reward: 1,...sai}\n// \tcontext.network_layer.sendTrainingData(data)\n\n// }\nconst appendStartHistory = assign({\n  start_state_history: (context, event) => {\n    var state = context.tutor.get_state();\n    var history = context.start_state_history || [];\n    history.push(state);\n    return history;\n  }\n});\n\nconst stateRecalc = assign({\n  state: (context, event) => {\n    if (context.staged_SAI == null || context.staged_SAI.reward > 0 || context.test_mode) {\n      return context.tutor.get_state();\n    } else {\n      return context.state;\n    }\n  }\n});\n\nconst assignFoci = assign({\n  staged_SAI: (context, event) => {\n    Object.assign(context.staged_SAI, {\n      foci_of_attention: context.tutor.get_current_foci()\n    });\n    return context.staged_SAI;\n  }\n});\n\n//CONDITIONS\nfunction saiIsCorrectDone(context, event) {\n  const sai_data = context.staged_SAI;\n  if (context.feedback_map && Object.keys(context.feedback_map).length > 0) {\n    return false;\n  }\n  return (\n    sai_data.selection === \"done\" &&\n    (sai_data.reward == null || sai_data.reward > 0 || context.test_mode)\n  );\n}\n\nfunction forceUseExample(context, event) {\n  const saiData = context.staged_SAI;\n  return (saiData.skipTraining && saiData.reward < 0) || context.examples_only;\n}\n\nfunction isFreeAuthor(context, event) {\n  \n  return context.free_author || false;\n}\n\nfunction checkIsCorrect(context, event) {\n  return event.data > 0;\n}\n\nfunction noApplicableSkills(context, event) {\n  console.log(\"CCCC\", context)\n  return !Object.keys(event.data).length || context.examples_only;\n}\n\nfunction logError(context, event) {\n  console.error(event.data);\n  // alert(\"FAIL\")\n}\n\n// var color_map = {\n// \t\"EXAMPLE\" : \"0;33;44m\",\n// \t\"CORRECT\" : \"0;30;42m\",\n// \t\"INCORRECT\" : \"0;30;41m\",\n// }\n\nfunction _kill_this(context, event) {\n  var nl = context.network_layer;\n  nl.kill_this(event.data.toString());\n}\n\nfunction printFeedback(context, event) {\n  var nl = context.network_layer;\n  var staged_SAI = context.staged_SAI;\n\n  var type = context.action_type;\n  // var reward = staged_SAI.reward\n  if (!context.feedback_map || Object.keys(context.feedback_map).length === 0) {\n    if (type == \"ATTEMPT\") {\n      type = staged_SAI.reward > 0 ? \"CORRECT\" : \"INCORRECT\";\n    }\n\n    // var color = color_map[type]\n    var inps =\n      staged_SAI.inputs[\"value\"] != null ? staged_SAI.inputs[\"value\"] : \"\";\n\n    nl.term_print(type + \": \" + staged_SAI.selection + \" -> \" + inps, type);\n  } else {\n    for (var index in context.feedback_map) {\n      var skill_app = context.skill_applications[index];\n      var type = context.feedback_map[index].toUpperCase();\n      // var color = color_map[type]\n      var inps =\n        skill_app.inputs[\"value\"] != null ? skill_app.inputs[\"value\"] : \"\";\n      nl.term_print(type + \": \" + skill_app.selection + \" -> \" + inps, type);\n    }\n  }\n}\n\nfunction clearSkillPanel(context, event) {\n  context.app.setState({\n    skill_panel_props: {\n      skill_set: { \"Applicable Skills\": {} }\n    }\n  });\n}\n\nfunction fillSkillPanel(context, event) {\n  context.app.setState({\n    skill_panel_props: {\n      skill_set: { \"Applicable Skills\": event.data[\"responses\"] || {} }\n    }\n  });\n}\n\nconst recalcFeedbackMap = send((context, event) => {\n  // const promise = new Promise((resolve,reject) => {\n  var skill = event.skill;\n  var match = event.match;\n  var label = event.label;\n\n  let match_id = match[\"_id\"];\n  // console.log(match[\"_id\"])\n  // console.log(this.state.feedback_map)\n  let feedback_map = context.feedback_map || {};\n  let new_label =\n    feedback_map[match_id] && label === feedback_map[match_id] ? null : label;\n\n  let new_feedback_map = { ...feedback_map };\n  if (new_label === null) {\n    delete new_feedback_map[match_id];\n  } else {\n    new_feedback_map[match_id] = new_label;\n  }\n\n  let was_empty = Object.keys(feedback_map).length === 0;\n  let now_empty = Object.keys(new_feedback_map).length === 0;\n\n  return {\n    type: \"FEEBACK_MAP_UPDATE\",\n    feedback_map: new_feedback_map,\n    was_empty: was_empty,\n    now_empty: now_empty\n  };\n  // if(!was_empty && now_empty){\n  //   \tconsole.log(\"EMPTY\")\n  //   \treturn {type: \"SKILL_PANEL_FEEDBACK_EMPTY\"}\n  // }else if(was_empty && !now_empty){\n  //   \tconsole.log(\"NOT EMPTY\")\n  //   \treturn {type :\"SKILL_PANEL_FEEDBACK_NONEMPTY\"}\n  // }\n  // return undefined\n  // });\n  // return promise;\n});\n\nconst assignFeedbackMap = assign({\n  feedback_map: (context, event) => {\n    if (context.skill_panel.updateFeedbackMap) {\n      context.skill_panel.updateFeedbackMap(event.feedback_map);\n    }\n    if (context.tutor.updateFeedbackMap) {\n      context.tutor.updateFeedbackMap(event.feedback_map);\n    }\n    return event.feedback_map;\n  }\n});\n\nconst toggleFeedbackStyle = send((context, event) => {\n  if (!event.was_empty && event.now_empty) {\n    console.log(\"EMPTY\");\n    return { type: \"SKILL_PANEL_FEEDBACK_EMPTY\" };\n  } else if (event.was_empty && !event.now_empty) {\n    console.log(\"NOT EMPTY\");\n    return { type: \"SKILL_PANEL_FEEDBACK_NONEMPTY\" };\n  }\n  return { type: \"\" };\n});\n\n// skill_set={skill_set}\n//\t\t\t\t\t\tselect_callback={select_callback}\n//\t\t\t\t\t\tcorrectness_callback={correctness_callback}\n//\t\t\t\t\t\t\tinitial_select={initial_select}\n//\t\t\t\t\t\t\twhere_colors={where_colors || undefined}\n//\t\t\t\t\t\t\t\tcurrent = {window.state_machine}\n//\t\t\t\t\t\t\t\tservice = {window.state_machine_service}\n\nfunction get_machine_actions(app) {\n  var tutor = app.tutor.current;\n  var skill_panel = app.skill_panel.current;\n  var buttons = app.network_layer.current;\n  var network_layer = app.network_layer;\n\n  return {\n    services: {\n      sendFeedback: (context, event) => {\n        if (context.staged_SAI.skipTraining || context.test_mode) {\n          return Promise.resolve(true);\n        }\n        return network_layer.sendFeedback(context, event);\n      },\n      //TODO: is this depricated?\n      sendFeedbackExplicit: (context, event) =>\n        network_layer.sendFeedbackExplicit(context, event),\n      applyNextExample: tutor.applyNextExample,\n      attemptStagedSAI: tutor.attemptStagedSAI,\n      queryApprentice: network_layer.queryApprentice,\n      checkApprentice: network_layer.checkApprentice\n    },\n    actions: {\n      logError: logError,\n\n      stateRecalc: stateRecalc,\n      assignResponse: assign({ response: (context, event) => event.data }),\n      assignStagedSAI: assign({ staged_SAI: (context, event) => event.data }),\n      assignExample: assign({ action_type: (context, event) => \"EXAMPLE\" }),\n      assignAttempt: assign({ action_type: (context, event) => \"ATTEMPT\" }),\n      assignCorrect: assign({\n        staged_SAI: (context, event) => {\n          return { ...context.staged_SAI, ...{ reward: 1 } };\n        }\n      }),\n      assignIncorrect: assign({\n        staged_SAI: (context, event) => {\n          return { ...context.staged_SAI, ...{ reward: -1 } };\n        }\n      }),\n      assignFoci: assignFoci,\n      clearFeedbackData: assign((context, event) => {\n        return {\n          reward: null,\n          // \"rewards\" : null,\n          staged_SAI: null,\n          skill_applications: null,\n          feedback_map: null\n        };\n      }),\n      assignSkillApplications: assign({\n        skill_applications: (context, event) =>\n          event.data.responses || event.data.skill_applications\n      }),\n      // done : window.signal_done,\n\n      printFeedback: printFeedback,\n      kill_this: _kill_this,\n      printEvent: (context, event) => {\n        console.log(\"P_EVT:\", event);\n      },\n\n      fillSkillPanel: fillSkillPanel,\n      clearSkillPanel: clearSkillPanel,\n      done: (context, event) => {\n        context.app.training_service.send(\"PROBLEM_DONE\");\n      },\n\n      enterSetStartStateMode: tutor.enterSetStartStateMode,\n      exitSetStartStateMode: tutor.exitSetStartStateMode,\n      enterFeedbackMode: tutor.enterFeedbackMode,\n      exitFeedbackMode: tutor.exitFeedbackMode,\n      enterFociMode: tutor.enterFociMode,\n      exitFociMode: tutor.exitFociMode,\n      enterTutoringMode: tutor.enterTutoringMode,\n      exitTutoringMode: tutor.exitTutoringMode,\n      displayCorrectness: tutor.displayCorrectness,\n      applyStagedSAI: (context, event) => {\n        tutor.applySAI(context.staged_SAI);\n      },\n      proposeSAI: (context, event) => tutor.proposeSAI(event.data),\n      confirmProposedSAI: (context, event) => {\n        tutor.confirmProposedSAI();\n      },\n      clearProposedSAI: (context, event) => {\n        tutor.clearProposedSAI();\n      },\n\n      recalcFeedbackMap: recalcFeedbackMap,\n      assignFeedbackMap: assignFeedbackMap,\n      toggleFeedbackStyle: toggleFeedbackStyle,\n\n      generate_nools: network_layer.generate_nools,\n      appendStartHistory: appendStartHistory\n    },\n    guards: {\n      saiIsCorrectDone: saiIsCorrectDone,\n      forceUseExample: forceUseExample,\n      noApplicableSkills: noApplicableSkills,\n      isFreeAuthor: isFreeAuthor,\n      checkIsCorrect: checkIsCorrect\n    }\n  };\n}\n\nexport function build_interactions_sm(\n  app,\n  inh_context,\n) {\n  var context = {\n    app: app,\n    tutor: app.tutor.current,\n    skill_panel: app.skill_panel.current,\n    buttons: app.buttons.current,\n    network_layer: app.network_layer,\n\n    //Dynamic\n    // last_correct : null,\n    staged_SAI: null,\n    action_type: null\n  };\n  context = {...context, ...inh_context}\n\n  var sm;\n  if (context.tutor_mode) {\n    sm = tutor_sm;\n  } else {\n    sm = context.interactive ? interactive_sm : non_interactive_sm;\n  }\n\n  const interaction_sm = Machine(\n    { ...{ context: context }, ...sm },\n    get_machine_actions(app)\n  );\n  return interaction_sm;\n}\n\n// ------------------------------- NON INTERACTIVE ----------------------------\n\nvar non_interactive_sm = {\n  initial: \"Start\",\n  states: {\n    Start: {\n      entry: \"stateRecalc\",\n      on: {\n        \"\": \"Querying_Apprentice\"\n      }\n    },\n    Querying_Apprentice: {\n      invoke: {\n        id: \"queryApprentice\",\n        src: \"queryApprentice\",\n        onDone: [\n          { target: \"Applying_Next_Example\", cond: \"noApplicableSkills\" },\n          { target: \"Applying_Staged_SAI\", actions: [\"assignStagedSAI\"] }\n        ],\n        onError: \"Fail\"\n      },\n      exit: \"assignResponse\"\n    },\n    Applying_Staged_SAI: {\n      invoke: {\n        id: \"attemptStagedSAI\",\n        src: \"attemptStagedSAI\",\n        onDone: {\n          target: \"Sending_Feedback\",\n          actions: [\"assignStagedSAI\", \"assignAttempt\"]\n        },\n        onError: \"Fail\"\n      }\n    },\n\n    Applying_Next_Example: {\n      invoke: {\n        id: \"applyNextExample\",\n        src: \"applyNextExample\",\n        onDone: {\n          target: \"Sending_Feedback\",\n          actions: [\"assignStagedSAI\", \"assignExample\"]\n        },\n        onError: \"Fail\"\n      }\n    },\n\n    Sending_Feedback: {\n      entry: \"printFeedback\",\n      invoke: {\n        id: \"sendFeedback\",\n        src: \"sendFeedback\",\n        onDone: [\n          { target: \"Done\", cond: \"saiIsCorrectDone\" },\n          { target: \"Applying_Next_Example\", cond: \"forceUseExample\" },\n          { target: \"Querying_Apprentice\" }\n        ],\n        onError: \"Fail\"\n      },\n      exit: [\"stateRecalc\", \"assignResponse\", \"clearFeedbackData\"]\n    },\n    Done: {\n      type: \"final\",\n      entry: \"done\"\n    },\n    Fail: {\n      entry: [\"logError\", \"kill_this\"]\n    }\n  }\n};\n\n// ------------------------------- INTERACTIVE ----------------------------\n\nvar interactive_sm = {\n  id: \"interactive\",\n  initial: \"Start\",\n  states: {\n    Start: {\n      entry: \"stateRecalc\",\n      on: {\n        \"\": [\n          { target: \"Setting_Start_State\", cond: \"isFreeAuthor\" },\n          { target: \"Querying_Apprentice\" }\n        ]\n      }\n    },\n    Setting_Start_State: {\n      entry: \"enterSetStartStateMode\",\n      on: {\n        START_STATE_SET: {\n          target: \"Querying_Apprentice\",\n          actions: [\"appendStartHistory\"]\n        }\n      },\n      exit: [\"exitSetStartStateMode\", \"stateRecalc\"]\n    },\n    Querying_Apprentice: {\n      invoke: {\n        id: \"queryApprentice\",\n        src: \"queryApprentice\",\n        onDone: [\n          {\n            target: \"Waiting_User_Feedback.Waiting_Demonstrate_Only\",\n            cond: \"noApplicableSkills\",\n            actions: [\"fillSkillPanel\"]\n          },\n          {\n            target: \"Waiting_User_Feedback.Waiting_Yes_No_Feedback\",\n            actions: [\"fillSkillPanel\", \"proposeSAI\", \"assignStagedSAI\"]\n          }\n        ],\n        onError: \"Fail\"\n      },\n      exit: \"assignSkillApplications\"\n    },\n    Waiting_User_Feedback: {\n      entry: \"enterFeedbackMode\",\n      //\n      initial: \"Waiting_Demonstrate_Only\",\n      states: {\n        Waiting_Demonstrate_Only: {},\n        Waiting_Yes_No_Feedback: {\n          on: {\n            SKILL_PANEL_FEEDBACK_NONEMPTY: \"Waiting_Submit_Feedback\",\n            // \"YES_PRESSED\" : {target : \"#interactive.Sending_Feedback\",\n            YES_PRESSED: {\n              target: \"#interactive.Sending_Feedback\",\n              actions: [\"assignCorrect\", \"assignAttempt\", \"confirmProposedSAI\"]\n            },\n            NO_PRESSED: {\n              target: \"#interactive.Sending_Feedback\",\n              actions: [\"assignIncorrect\", \"assignAttempt\", \"clearProposedSAI\"]\n            }\n          }\n        },\n        Waiting_Submit_Feedback: {\n          on: {\n            SKILL_PANEL_FEEDBACK_EMPTY: \"Waiting_Yes_No_Feedback\",\n            SUBMIT_SKILL_FEEDBACK: {\n              target: \"#interactive.Sending_Feedback\",\n              actions: [\"clearProposedSAI\"]\n            }\n          }\n        }\n      },\n      //\n      on: {\n        STAGE_SAI: { actions: [\"assignStagedSAI\", \"proposeSAI\"] },\n        //\n        TOGGLE_FEEDBACK: { actions: \"recalcFeedbackMap\" }, //, onDone:{actions :\"callSend\"}, onError: 'Fail'}},\n        FEEBACK_MAP_UPDATE: {\n          actions: [\"assignFeedbackMap\", \"toggleFeedbackStyle\"]\n        }, //, onDone:{actions :\"callSend\"}, onError: 'Fail'}},\n        //\n        DEMONSTRATE: {\n          target: \"Waiting_Select_Foci\",\n          actions: [\n            \"assignStagedSAI\",\n            \"assignExample\",\n            \"printEvent\",\n            \"clearProposedSAI\"\n          ]\n        },\n        GEN_NOOLS: { actions: [\"generate_nools\"] }\n      },\n\n      exit: [\"exitFeedbackMode\"]\n    },\n    // \"Applying_Staged_SAI\" : {\n    // \tinvoke : {\n    //         id: \"attemptStagedSAI\",\n    //         src: \"attemptStagedSAI\",\n    //         onDone: \"Sending_Feedback\",\n    //         onError: 'Fail',\n    // \t},\n    // },\n    Waiting_Select_Foci: {\n      entry: \"enterFociMode\",\n      on: {\n        \"\": {\n          target: \"Sending_Feedback\",\n          actions: \"assignFoci\",\n          cond: \"saiIsCorrectDone\"\n        },\n        FOCI_DONE: { target: \"Sending_Feedback\", actions: \"assignFoci\" }\n      },\n      exit: \"exitFociMode\"\n    },\n    Sending_Feedback: {\n      entry: [\"printFeedback\"],\n      invoke: {\n        id: \"sendFeedback\",\n        src: \"sendFeedback\",\n        onDone: [\n          // {target: \"Setting_Start_State\", cond : },\n          { target: \"Done\", cond: \"saiIsCorrectDone\" },\n          // { target: \"Applying_Next_Example\", cond: \"forceUseExample\" },\n          { target: \"Querying_Apprentice\" }\n        ],\n        onError: \"Fail\"\n      },\n      exit: [\"stateRecalc\", \"assignResponse\", \"clearFeedbackData\"]\n    },\n    // Sending_Feedback_Explicit : {\n    // \tentry : 'printFeedback',\n    // \tinvoke : {\n    //         id: \"sendFeedbackExplicit\",\n    //         src: \"sendFeedbackExplicit\",\n    //         onDone: [\n    // \t        // {target: \"Setting_Start_State\", cond : },\n    // \t        // {target: \"Done\", cond : \"saiIsCorrectDone\"},\n    // \t        {target: \"Querying_Apprentice\"},\n    //         ],\n    //         onError: 'Fail',\n    // \t},\n    // \texit:[\"stateRecalc\",\"assignResponse\",\"clearFeedbackData\"]\n    // },\n    Done: {\n      type: \"final\",\n      entry: [\"clearSkillPanel\", \"done\"]\n      // on : {\n      // \t\"\" : {target  : \"Setting_Start_State\", cond : \"isFreeAuthor\"},\n      // },\n    },\n    Fail: {\n      entry: [\"logError\", \"kill_this\"]\n    }\n  }\n};\n\nconst tutor_sm = {\n  id: \"interactive\",\n  initial: \"Start\",\n  states: {\n    Start: {\n      entry: \"stateRecalc\",\n      on: {\n        \"\": [\n          { target: \"Setting_Start_State\", cond: \"isFreeAuthor\" },\n          { target: \"Waiting_User_Attempt\" }\n        ]\n      }\n    },\n    Setting_Start_State: {\n      entry: \"enterSetStartStateMode\",\n      on: {\n        START_STATE_SET: {\n          target: \"Waiting_User_Attempt\",\n          actions: [\"appendStartHistory\"]\n        }\n      },\n      exit: [\"exitSetStartStateMode\", \"stateRecalc\"]\n    },\n    Waiting_User_Attempt: {\n      entry: [\"enterTutoringMode\", \"stateRecalc\"],\n      on: {\n        ATTEMPT: {\n          target: \"Checking_Against_Apprentice\",\n          actions: \"assignStagedSAI\"\n        }\n      },\n      exit: \"exitTutoringMode\"\n    },\n    Checking_Against_Apprentice: {\n      invoke: {\n        id: \"checkApprentice\",\n        src: \"checkApprentice\",\n        onDone: [\n          {\n            cond: \"saiIsCorrectDone\",\n            target: \"Done\",\n            actions: [\"displayCorrectness\", \"assignCorrect\"]\n          },\n          {\n            cond: \"checkIsCorrect\",\n            target: \"Waiting_User_Attempt\",\n            actions: [\"displayCorrectness\", \"assignCorrect\"]\n          },\n          {\n            target: \"Waiting_User_Attempt\",\n            actions: [\"displayCorrectness\", \"assignIncorrect\"]\n          }\n        ]\n      }\n      // exit : \"stateRecalc\"\n    },\n    Done: {\n      type: \"final\",\n      entry: [\"clearSkillPanel\", \"done\"]\n    }\n  }\n};\n\n// const feedbackStates = {\n// \tinitial: \"Waiting_For_Applicable_Skills\",\n// \tstates: {\n// \t\t\"Waiting_For_Applicable_Skills\" :{\n// \t\t\tentry : ['queryApprentice'],\n// \t\t\ton : {\n// \t\t\t\t\"APPLICABLE_SKILLS_RECIEVED\" : \"Query_Yes_No_Feedback\",\n// \t\t\t\t\"NO_SKILLS_RECIEVED\" : \"No_Query_Feedback\"\n// \t\t\t}\n// \t\t},\n// \t\t\"Waiting_For_Training_Recieved\" :{\n// \t\t\ton : {\n// \t\t\t\t\"TRAINING_RECIEVED\" : \"Waiting_For_Applicable_Skills\",\n// \t\t\t}\n// \t\t},\n// \t\t\"No_Query_Feedback\" : {\n// \t\t\ton : {\n// \t\t\t\t\"SKILL_PANEL_FEEDBACK_NONEMPTY\" : \"Query_Submit_Feedback\"\n// \t\t\t}\n// \t\t},\n// \t\t\"Query_Yes_No_Feedback\" : {\n// \t\t\ton : {\n// \t\t\t\t\"SKILL_PANEL_FEEDBACK_NONEMPTY\" : \"Query_Submit_Feedback\",\n// \t\t\t\t\"YES_PRESSED\" : \"Waiting_For_Training_Recieved\",\n// \t\t\t\t\"NO_PRESSED\" : \"Waiting_For_Training_Recieved\",\n// \t\t\t}\n// \t\t},\n// \t\t\"Query_Submit_Feedback\" : {\n// \t\t\ton : {\n// \t\t\t\t\"SKILL_PANEL_FEEDBACK_EMPTY\" : [\n// \t\t\t\t\t{target : \"Query_Yes_No_Feedback\", },\n// \t\t\t\t\t{target : \"No_Query_Feedback\"}\n// \t\t\t\t],\n// \t\t\t\t\"SUBMIT_SKILL_FEEDBACK\": \"Waiting_For_Training_Recieved\"\n// \t\t\t}\n// \t\t}\n// \t}\n// }\n\n// const ButtonsMachine = Machine({\n//   \"initial\": \"Specify_Start_State\",\n//   \"states\": {\n//   \t\"Specify_Start_State\": {\n//   \t\ton: { \"START_STATE_SET\": \"Query_Demonstrate\" },\n//   \t},\n//     \"Query_Demonstrate\": {\n//       on: { \"DEMONSTRATE\": \"Request_Foci\",\n//        \t\t\"DONE\": \"Specify_Start_State\" },\n\n//       ...feedbackStates\n//     },\n//     \"Request_Foci\": {\n//       on: {\n//         \"FOCI_DONE\": \"Query_Demonstrate\",\n//       },\n//     },\n//     \"Explantions_Displayed\": {\n//       on: {\n//         \"NEXT_PRESSED\": \"Query_Demonstrate\",\n//         \"DEMONSTRATE\": \"Request_Foci\",\n//         \"DONE\": \"Specify_Start_State\"\n//       },\n\n//     },\n//   }\n// },\n// {\n// \tactions: {\n// \t\tqueryApprentice : (context,event) => {\n// \t\t\twindow.queryApprentice()\n// \t\t}\n// \t}\n// }\n// )\n\n// window.new_nonInteractiveMachine = () => {\n// \tvar machine = build_SM_NonInteractive(window.tutor,window.network_layer,window.agent_id)\n// \tvar machine_service = interpret(machine)\n// \tmachine_service.start()\n// \treturn machine_service\n// }\n\n// const load_training_file = () => {};\n// const serve_next_training_set = () => {};\n// const serve_next_agent = () => {};\n// const serve_next_problem = () => {};\n// const runWhenReady = () => {};\n// const query_outerloop = () => {};\n\n// function make_training_handler(){\n// \tconst sm= Machine({\n// \t\tinitial: \"Loading_Training_File\",\n// \t\tstates: {\n// \t\t\tLoading_Training_File: {\n// \t\t\t\tinvoke : {\n// \t\t\t\t\tid: \"load_training_file\",\n// \t\t\t\t\tsrc: \"load_training_file\",\n// \t\t\t\t\tonDone: \"Serving_Training_Sets\",\n// \t\t\t\t\tonError: 'Fail',\n// \t\t\t\t}\n// \t\t\t},\n// \t\t\tServing_Training_Sets: {\n// \t\t\t\tinvoke : {\n// \t\t\t\t\tid: \"serve_next_training_set\",\n// \t\t\t\t\tsrc: \"serve_next_training_set\",\n// \t\t\t\t\tonDone: [{target : \"All_Done\", cond : \"iteratorEmpty\"},\n// \t\t\t\t\t\t\t {target : \"Serving_Agents\"}],\n// \t\t\t\t\tonError: 'Fail',\n// \t\t\t\t\t}\n// \t\t\t},\n// \t\t\tServing_Agents: {\n// \t\t\t\tinvoke : {\n// \t\t\t\t\tid: \"serve_next_agent\",\n// \t\t\t\t\tsrc: \"serve_next_agent\",\n// \t\t\t\t\tonDone: [{target : \"Serving_Training_Sets\", cond : \"iteratorEmpty\"},\n// \t\t\t\t\t\t\t {target : \"Serving_Problems\"}],\n// \t\t\t\t\tonError: 'Fail',\n// \t\t\t\t}\n// \t\t\t},\n// \t\t\tServing_Problems: {\n// \t\t\t\tinvoke : {\n// \t\t\t\t\tid: \"serve_next_problem\",\n// \t\t\t\t\tsrc: \"serve_next_problem\",\n// \t\t\t\t\tonDone: [{target : \"Serving_Agents\", cond : \"iteratorEmpty\"},\n// \t\t\t\t\t\t\t {target : \"Waiting_Problem_Load\"}],\n// \t\t\t\t\tonError: 'Fail',\n// \t\t\t\t}\n// \t\t\t},\n// \t\t\tWaiting_Problem_Load:{\n// \t\t\t\tinvoke : {\n// \t\t\t\t\tid: \"set_problem_src\",\n// \t\t\t\t\tsrc: \"set_problem_src\",\n// \t\t\t\t\tonDone: \"Training\",\n// \t\t\t\t\tonError: 'Fail',\n// \t\t\t\t}\n// \t\t\t},\n\n// \t\t// \"Waiting_For_OuterLoop\": {\n// \t\t// \tentry: query_outerloop,\n// \t\t// \ton: {\"PROBLEM_START_LOAD\": \"Waiting_Problem_Load\"}\n// \t\t// },\n\n// \t\t\tTraining: {\n// \t\t\t\tinvoke : {\n// \t\t\t\t\tid: \"training_state_machine\",\n// \t\t\t\t\tsrc: \"training_state_machine\",\n// \t\t\t\t\tonDone: \"Serving_Problems\",\n// \t\t\t\t\tonError: 'Fail',\n// \t\t\t\t}\n// \t\t\t},\n// \t\t// \"Explantions_Displayed\": {\n// \t\t//   on: {\n// \t\t//     \"NEXT_PRESSED\": \"Query_Demonstrate\",\n// \t\t//     \"DEMONSTRATE\": \"Request_Foci\",\n// \t\t//     \"DONE\": \"Specify_Start_State\"\n// \t\t//   },\n\n// \t\t// },\n// \t\t\tAll_Done : {\n// \t\t\t\ttype : 'final',\n// \t\t\t},\n// \t\t\tFail : {\n// \t\t\t\tentry : [\"logError\",\"kill_this\"]\n// \t\t\t}\n// \t\t}\n// \t})\n// }\n\n// const TrainingJSON_SM= Machine({\n//   \"initial\": \"Loading_Training_File\",\n//   \"states\": {\n//   \t\"Loading_Training_File\": {\n//   \t\tentry: load_training_file,\n//   \t\ton: { \"TRAINING_FILE_LOADED\": \"Serving_Training_Sets\" },\n//   \t},\n//   \t\"All_Done\" : {},\n//     \"Serving_Training_Sets\": {\n//     \tentry: serve_next_training_set,\n//       \ton: { \"TRAINING_SET_LOADED\": \"Serving_Agents\",\n//       \t\t  \"NO_MORE_TRAINING_SETS\" : \"All_Done\"},\n//     },\n//     \"Serving_Agents\": {\n//     \tentry: serve_next_agent,\n//     \ton: {\"AGENT_CREATED\": \"Serving_Problem\",\n//       \t\t \"NO_MORE_AGENTS\" : \"Serving_Training_Sets\"},\n//     },\n//     \"Serving_Problems\": {\n//     \tentry: serve_next_problem,\n//     \ton: {\"PROBLEM_START_LOAD\": \"Waiting_Problem_Load\",\n//     \t\t \"QUERY_OUTERLOOP\": \"Waiting_For_OuterLoop\",\n//       \t\t \"NO_MORE_PROBLEMS\" : \"Serving_Agents\"},\n//     },\n//     \"Waiting_Problem_Load\":{\n//     \tentry: runWhenReady,\n//     \ton: {\"PROBLEM_LOADED\": \"Training\"}\n//     },\n//     \"Waiting_For_OuterLoop\": {\n//     \tentry: query_outerloop,\n//     \ton: {\"PROBLEM_START_LOAD\": \"Waiting_Problem_Load\"}\n//     },\n\n//     \"Training\": {\n//     \ton: {\"PROBLEM_DONE\": \"Serving_Problems\"},\n//     },\n//     \"Explantions_Displayed\": {\n//       on: {\n//         \"NEXT_PRESSED\": \"Query_Demonstrate\",\n//         \"DEMONSTRATE\": \"Request_Foci\",\n//         \"DONE\": \"Specify_Start_State\"\n//       },\n\n//     },\n//   }\n// },\n// {\n// \tactions: {\n// \t\tqueryApprentice : (context,event) => {\n// \t\t\twindow.queryApprentice()\n// \t\t}\n// \t}\n// }\n// )\n\nexport default build_interactions_sm;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport SkillPanel from \"./components/skill_panel\";\nimport Buttons from \"./components/buttons\";\nimport * as serviceWorker from \"./serviceWorker\";\n// import ButtonsMachine from './interactions.js'\n\nimport { interpret } from \"xstate\";\nimport CTAT_Tutor from \"./tutors/CTAT/CTAT_Tutor\";\n//import StylusTutor from './tutors/Stylus/StylusTutor';\nimport App from \"./App\";\nimport RJSON from \"relaxed-json\";\n\nconst tutor_map = {\n  ctatttutor: CTAT_Tutor,\n  ctat: CTAT_Tutor\n  //\"stylustutor\" : StylusTutor,\n  //\"stylus\" : StylusTutor,\n};\n\nfunction load_training_file(training_file) {\n  // console.log(\"SLOOPERZ\",training_file)\n  return fetch(training_file)\n    .then(str => str.text()) //str.json())\n    .then(str => RJSON.parse(str)); //str.json())\n}\n\nfunction safeParse(json) {\n  var parsed;\n  try {\n    parsed = JSON.parse(json);\n  } catch (e) {\n    parsed = null;\n  }\n  return parsed;\n}\n\nfunction getWebProps() {\n  var urlParams = new URLSearchParams(window.location.search.substring(1));\n  console.log(window.location.search);\n  console.log(urlParams);\n\n  var props = {\n    AL_URL: urlParams.get(\"al_url\"),\n    OUTER_LOOP_URL: urlParams.get(\"outer_loop_url\"),\n    HOST_URL: window.location.origin,\n    training_file: urlParams.get(\"training\"),\n    interactive: safeParse((urlParams.get(\"interactive\") || \"\").toLowerCase()),\n    use_foci: safeParse((urlParams.get(\"use_foci\") || \"\").toLowerCase()),\n    tutor: urlParams.get(\"tutor\"),\n    nools_dir: urlParams.get(\"nools_dir\")\n  };\n\n  console.log(\"PROPS\", props, urlParams.get(\"interactive\"));\n  return props;\n}\n\nfunction removeEmpty(obj) {\n  var out = {};\n  console.log(obj);\n  Object.keys(obj).forEach(key => {\n    console.log(key);\n    if (obj[key] != null) {\n      out[key] = obj[key];\n    }\n  });\n  return out;\n}\n\nvar props = getWebProps();\n\nprops.training_file = props.training_file || \"/stylus_author.json\";\n// console.log(\"WEE\", props.training_file)\n\nload_training_file(props.training_file).then(function(training_json) {\n  // console.log(\"BOOPERSZ\", training_json)\n  var training_file_props = training_json.set_params;\n  props = { ...training_file_props, ...removeEmpty(props) };\n  props.tutor = (props.tutor || \"ctat\").toLowerCase().replace(\"_\", \"\");\n  ReactDOM.render(\n    <App\n      ref={app => {\n        window.react_interface = app;\n      }}\n      style={{ height: \"100%\" }}\n      //tutorClass={tutor_map[props.tutor] || StylusTutor}\n      tutorClass={tutor_map[props.tutor]}\n      {...props}\n    />,\n    document.getElementById(\"root\")\n  );\n});\n\nif (false) {\n  // function setSkillWindowState(evt){\n\n  // }\n  // window.state_machine = ButtonsMachine.initialState\n  // window.state_machine_service = interpret(ButtonsMachine)\n  // window.state_machine_service.start()\n\n  // const state = {\n  //   current:\n  // };\n  // window.state_machine_service.onTransition(current => {\n  // \tconsole.log(\"current.value\")\n  // \tconsole.log(current.value)\n  // \tsetButtonsState(current,window.debugmode)\n\n  //   // this.setState({ current : current })\n  //   }\n  // );\n\n  // function setButtonCallbacks(callbacks){\n  // window.button_callbacks = callbacks\n  // }\n  // window.setButtonCallbacks = setButtonCallbacks\n\n  // function setNoolsCallback(callback){\n  // \twindow.nools_callback = callback\n  // }\n  // window.setNoolsCallback = setNoolsCallback\n\n  function setSkillWindowState(\n    skill_set,\n    select_callback,\n    correctness_callback,\n    initial_select = null,\n    where_colors = null\n  ) {\n    ReactDOM.render(\n      //<View>\n      <CTAT_Tutor></CTAT_Tutor>,\n      //<SkillPanel skill_set={skill_set}\n      //\t\t\t\t\t\tselect_callback={select_callback}\n      //\t\t\t\t\t\tcorrectness_callback={correctness_callback}\n      //\t\t\t\t\t\t\tinitial_select={initial_select}\n      //\t\t\t\t\t\t\twhere_colors={where_colors || undefined}\n      //\t\t\t\t\t\t\t\tcurrent = {window.state_machine}\n      //\t\t\t\t\t\t\t\tservice = {window.state_machine_service}\n      //\n      //\t\t\t\t\t\t\t\t/>\n      //\t\t</View>\n      document.getElementById(\"skill_panel\")\n    );\n  }\n\n  function setButtonsState(current, debugmode = false) {\n    window.state_machine = current;\n    ReactDOM.render(\n      <Buttons\n        current={current}\n        service={window.state_machine_service}\n        debugmode={debugmode}\n        callbacks={window.button_callbacks}\n        nools_callback={window.nools_callback}\n      />,\n      document.getElementById(\"buttons\")\n    );\n  }\n\n  window.setSkillWindowState = setSkillWindowState;\n  window.setButtonCallbacks = setSkillWindowState;\n  window.setButtonsState = setButtonsState;\n\n  // function render(){\n  // let sections = [\n  // \t              {title: 'D', data: ['Devin the long named fool']},\n  // \t              {title: 'J', data: ['Jackson', 'James', 'Jillian', 'Jimmy', 'Joel', 'John', 'Julie']},\n  // \t              {title: 'B', data: ['Backson', 'Bames', 'Billian', 'Bimmy', 'Boel', 'Bohn', 'Bulie']},\n  // \t            ];\n\n  let test_skills = {\n    explanations: [\n      {\n        name: \"E0 + E1\",\n        how: \"E0 + E1\",\n        where: { A: { B: 1 } },\n        when: \"WHEN PART\",\n        which: 7.0,\n        mapping: { \"?sel\": \"A1\", \"?arg0\": \"B1\", \"?arg1\": \"C1\" }\n      },\n      {\n        name: \"E0 + E1\",\n        how: \"E0 + E1\",\n        where: \"WHERE PART\",\n        when: \"WHEN PART\",\n        which: 7.0,\n        mapping: { \"?sel\": \"A2\", \"?arg0\": \"B2\", \"?arg1\": \"C2\" }\n      },\n      {\n        name: \"(E0 + E1) // 10\",\n        how: \"(E0 + E1) // 10\",\n        where: \"WHERE PART\",\n        when: \"WHEN PART\",\n        which: 4.0,\n        mapping: { \"?sel\": \"A1\", \"?arg0\": \"B1\", \"?arg1\": \"C1\" }\n      },\n      {\n        name: \"(E0 + E1) // 10\",\n        how: \"(E0 + E1) // 10\",\n        where: \"WHERE PART\",\n        when: \"WHEN PART\",\n        which: 4.0,\n        mapping: { \"?sel\": \"A2\", \"?arg0\": \"B2\", \"?arg1\": \"C2\" }\n      }\n    ],\n    \"other skills\": [\n      {\n        name: \"(E0 + E1) // 10\",\n        how: \"E0 + E1 + E2\",\n        where: \"WHERE PART (E0 + E1 + E2)\",\n        when: \"WHEN PART (E0 + E1 + E2)\",\n        which: 3.0\n      },\n      {\n        name: \"(E0 + E1 + E2) // 10\",\n        how: \"E0 + E1\",\n        where: \"WHERE PART ((E0 + E1 + E2) // 10)\",\n        when: \"WHEN PART ((E0 + E1 + E2) // 10)\",\n        which: 8.0\n      }\n    ]\n  };\n  // setSkillWindowState({\"skills:\": []});\n\n  if (!process.env.NODE_ENV || process.env.NODE_ENV === \"development\") {\n    window.debugmode = true;\n    window.query_apprentice = () => {};\n    setButtonsState(window.state_machine, true);\n    setSkillWindowState(test_skills);\n  } else {\n    window.debugmode = false;\n  }\n}\n// setButtonsState(\"press_next\",true,true);\n\n// }\n// document.getElementById('render_button').addEventListener(\"click\",render)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","module.exports = __webpack_public_path__ + \"static/media/Arrowhead-01-128.3fbf838f.png\";","module.exports = __webpack_public_path__ + \"static/media/Arrowhead-Down-01-128.912d4e8d.png\";","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport WebView from \"react-native-web-webview\";\nimport autobind from \"class-autobind\";\n\n// import WebViewFile from '../../examples/FracPreBake/FractionArithmetic/HTML/fraction_arithmetic.html';\nimport {\n  Icon,\n  View,\n  Text,\n  StyleSheet,\n  Platform //,\n  // WebView\n} from \"react-native\";\n\nconst queryString = require(\"query-string\");\nconst path = require(\"path\");\n\nvar $ = require(\"jquery\");\n\n// const post_message =\n// \"\\\n// function waitForBridge() {\\\n//    //the react native postMessage has only 1 parameter\\\n//    //while the default one has 2, so check the signature\\\n//    //of the function\\\n//    if (window.postMessage.length !== 1){\\\n//      setTimeout(waitForBridge, 200);\\\n//    }\\\n//    else {\\\n//      window.postMessage(document);\\\n//    }\\\n// }\\\n// \\\n// window.onload = waitForBridge;\\\n// \";\n\nfunction checkTypes(element, types) {\n  var ok = false;\n  for (var i = types.length - 1; i >= 0; i--) {\n    var type = types[i];\n    if (element.classList.contains(type)) ok = true;\n  }\n  return ok;\n}\n\nclass CTAT_Tutor extends React.Component {\n  constructor(props) {\n    super(props);\n    autobind(this);\n\n    this.where_colors = [\n      \"darkorchid\",\n      \"#ff884d\",\n      \"#52d0e0\",\n      \"#feb201\",\n      \"#e44161\",\n      \"#ed3eea\",\n      \"#2f85ee\",\n      \"#562ac6\",\n      \"#cc24cc\"\n    ];\n\n    this.relative_pos_cache = {};\n\n    this.color_class_map = {\n      EXAMPLE: \"CTAT--example\",\n      CORRECT: \"CTAT--correct\",\n      INCORRECT: \"CTAT--incorrect\",\n      HIGHLIGHT: \"CTAT--AL_highlight\",\n      START_STATE: \"CTAT--AL_start\",\n      ATTEMPT: \"\",\n      DEFAULT: \"\"\n    };\n\n    this.ctat_webview = React.createRef();\n\n    this.state = {\n      // \"mode\" : this.props.mode || \"train\",\n      source:\n        \"../../examples/FracPreBake/FractionArithmetic/HTML/fraction_arithmetic.html?question_file=../mass_production/mass_production_brds/AD 5_9_plus_3_7.brd\"\n    };\n    this.start_state_history = [];\n    this.highlighted_elements = [];\n\n    // window.setMode = (mode) => {this.setState({mode : mode })}\n  }\n\n  // setMode(mode){\n  //   if(this.state.mode == \"train\" && mode == \"tutor\"){\n  //     this.clearProposedSAI()\n  //   }\n\n  //   this.setState({mode : mode })\n\n  // }\n\n  componentDidMount() {\n    // window.ctat_webview = this.ctat_webview.current\n\n    console.log(\"THIS\", this);\n    // this.graph = this.iframe_content.CTAT.ToolTutor.tutor.getGraph() || false;\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    console.log(\"UPDATED\", this.state);\n    this.iframe = this.ctat_webview.current;\n\n    if (!this.init_callback) {\n      this.init_callback = x => {};\n    }\n\n    // this._triggerWhenInitialized()\n  }\n\n  loadProblem(context) {\n    const prob_obj = context.prob_obj;\n    const nl = context.network_layer;\n    const interactive = context.interactive;\n    this.interactive = context.interactive;\n    this.setState({ source: { html: LOAD_SCREEN } });\n    const promise = new Promise((resolve, reject) => {\n      var HTML_name = prob_obj[\"HTML\"]\n        .substring(prob_obj[\"HTML\"].lastIndexOf(\"/\") + 1)\n        .replace(\".html\", \"\");\n\n      var domain_name = prob_obj[\"domain_name\"] || HTML_name;\n\n      // Point the iframe to the HTML and question_file (brd or nools) for the next problem\n\n      // iframe_content.CTAT = null;\n      // iframe_content.CTATCommShell = null;\n\n      var HTML_PATH = prob_obj[\"HTML\"];\n      if (!path.isAbsolute(HTML_PATH)) {\n        HTML_PATH = path.join(context.working_dir || \"/\", HTML_PATH);\n      }\n      // console.log(\"working_dir: \", working_dir)\n      // console.log(\"HTML_PATH: \", HTML_PATH)\n\n      // if(session_id == null){\n      //     user_guid = \"Stu_\" + CTATGuid.guid();\n      //     session_id = CTATGuid.guid();\n      // }\n\n      var qf_exists =\n        prob_obj[\"question_file\"] != undefined &&\n        prob_obj[\"question_file\"].toUpperCase() != \"INTERACTIVE\";\n      var BRD_name, free_authoring;\n      if (qf_exists) {\n        BRD_name = prob_obj[\"question_file\"]\n          .substring(prob_obj[\"question_file\"].lastIndexOf(\"/\") + 1)\n          .replace(\".brd\", \"\")\n          .replace(\".nools\", \"\");\n        free_authoring = false;\n      } else {\n        BRD_name = \"FREE AUTHORING\";\n        free_authoring = true;\n      }\n      // this.free_authoring =\n      // term_print(prob_obj[\"question_file\"])\n\n      nl.term_print(\"Starting Problem: \" + BRD_name, \"INFO\");\n\n      var qf = qf_exists\n        ? { question_file: prob_obj[\"question_file\"] }\n        : { question_file: \"/src/empty.nools\" };\n\n      console.log(\"qf\", qf, interactive, prob_obj);\n      if (!interactive && qf[\"question_file\"].includes(\".nools\")) {\n        nl.kill_this(\n          \"Question file cannot be nools in non-interactive mode. Use example tracing.\"\n        );\n      }\n      var logging_params = {\n        problem_name: BRD_name,\n        dataset_level_name1: domain_name,\n        dataset_level_type1: \"Domain\",\n        SessionLog: \"true\",\n        Logging: \"ClientToLogServer\",\n        log_service_url: window.location.origin,\n        user_guid: context.agent_name,\n        session_id: context.session_id\n      };\n      if (\"problem_context\" in prob_obj) {\n        logging_params[\"problem_context\"] = prob_obj[\"problem_context\"];\n      }\n\n      if (\"custom_fields\" in prob_obj) {\n        var custom_fields = prob_obj[\"custom_fields\"];\n        for (var [i, key] of Object.keys(custom_fields).entries()) {\n          logging_params[\"custom_field_name\" + String(i)] = key;\n          logging_params[\"custom_field_value\" + String(i)] = custom_fields[key];\n        }\n      }\n      var params = Object.assign({}, qf, logging_params); //Merge dictionaries\n\n      this.HTML_PATH = HTML_PATH;\n      this.init_callback = () => {\n        resolve({ updateContext: { free_author: free_authoring } });\n      };\n      var source = HTML_PATH + \"?\" + queryString.stringify(params);\n      console.log(\"source\", source);\n      this.graph = null;\n      this.commLibrary = null;\n      this.hasConfig = null;\n      this.setState({\n        source: { uri: source },\n        onLoad: this._triggerWhenInitialized,\n        // TODO: [nr] convert elements to string?\n        steps: prob_obj[\"only_step_ids\"] ? prob_obj[\"only_step_ids\"].flat() : null,\n        selections: prob_obj[\"only_Selections\"]\n          ? prob_obj[\"only_Selections\"].flat() : null\n      });\n      // this.iframe.onLoad = this._triggerWhenInitialized;\n      // this.iframe.src = HTML_PATH + \"?\" + queryString.stringify( params ).search;\n      // setTimout(this._triggerWhenInitialized(),10)\n    });\n    return promise;\n  }\n\n  _inject_element(elm_type, attributes = {}) {\n    var elm = this.iframe_content.document.createElement(elm_type);\n    for (var attr in attributes) {\n      elm.setAttribute(attr, attributes[attr]);\n    }\n    this.iframe_content.document\n      .getElementsByTagName(\"head\")[0]\n      .appendChild(elm);\n  }\n\n  /*\n  _checkAndStartTrigger(){\n      this.iframe_content = this.iframe.frameRef.contentWindow;\n    // if(this.iframe_content.document){\n      this._inject_element('link',   {href:'/CTAT/CTAT.css',type: \"text/css\",rel: \"stylesheet\"})\n      this._inject_element('link',   {href:'/CTAT/normalize.css',type: \"text/css\",rel: \"stylesheet\"})\n      this._inject_element('link',   {href:'/CTAT/front-end.css',type: \"text/css\",rel: \"stylesheet\"})\n      this._inject_element('script', {\"data-silex-static\" : true, type:'text/javascript', src : \"/CTAT/jquery.min.js\"})\n      this._inject_element('script', {\"data-silex-static\" : true, type:'text/javascript', src : \"/CTAT/nools.js\"})\n      this._inject_element('script', {\"data-silex-static\" : true, type:'text/javascript', src : \"/CTAT/ctat.min.js\"})\n      \n      window.setTimeout(() => {\n        this._inject_element('script', {\"data-silex-static\" : true, type:'text/javascript', src : \"/CTAT/ctatloader.js\"})\n        this._triggerWhenInitialized()      \n      }, 100);\n      \n    // }else{\n    //   window.setTimeout(() => {this._checkAndStartTrigger()}, 200);\n    // }\n    \n    \n  }*/\n\n  _triggerWhenInitialized() {\n    console.log(\"TRIGGER WHEN INITIALIZED\");\n    this.iframe_content = this.iframe.frameRef.contentWindow;\n    const iframe_content = this.iframe_content;\n\n    if (\n      typeof iframe_content.CTAT == \"undefined\" ||\n      iframe_content.CTAT == null ||\n      typeof iframe_content.CTATCommShell == \"undefined\" ||\n      iframe_content.CTATCommShell == null ||\n      typeof iframe_content.CTATCommShell.commShell == \"undefined\" ||\n      iframe_content.CTATCommShell.commShell == null ||\n      typeof iframe_content.CTAT.ToolTutor == \"undefined\" ||\n      iframe_content.CTAT.ToolTutor == null ||\n      typeof iframe_content.CTAT.ToolTutor.tutor == \"undefined\" ||\n      iframe_content.CTAT.ToolTutor.tutor == null\n    ) {\n      // term_print('\\x1b[0;30;47m' + \"BLEHH1\" +  '\\x1b[0m');\n      console.log(\"BLEHH1\");\n      window.setTimeout(() => {\n        this._triggerWhenInitialized();\n      }, 500);\n      return;\n    }\n    this.graph = iframe_content.CTAT.ToolTutor.tutor.getGraph() || false;\n    this.commLibrary = iframe_content.CTATCommShell.commShell.getCommLibrary();\n    this.hasConfig = iframe_content.CTATConfiguration != undefined;\n\n    // console.log(\"graph\")\n    // console.log(graph)\n    // console.log(\"comm\")\n    // console.log(commLibrary)\n    // console.log(hasConfig)\n\n    if (\n      (this.graph || this.interactive) &&\n      this.commLibrary &&\n      this.hasConfig\n    ) {\n      this._inject_element(\"link\", {\n        href: \"/css/AL_colors.css\",\n        type: \"text/css\",\n        rel: \"stylesheet\"\n      });\n      // var link = iframe_content.document.createElement('link');\n      // link.setAttribute('rel', 'stylesheet');\n      // link.setAttribute('type', 'text/css');\n      // // link.setAttribute('href', \"../\".repeat(working_dir.split('/').length+1) + 'css/AL_colors.css');\n      // link.setAttribute('href', document.location.origin + '/css/AL_colors.css');\n      // iframe_content.document.getElementsByTagName('head')[0].appendChild(link);\n\n      //Gets rid of annyoing sai printout on every call to sendXML\n      iframe_content.flashVars.setParams({ deliverymode: \"bleehhhh\" });\n\n      //Grab these event constants from CTAT\n      this.CTAT_CORRECT =\n        iframe_content.CTAT.Component.Base.Tutorable.EventType.correct;\n      this.CTAT_INCORRECT =\n        iframe_content.CTAT.Component.Base.Tutorable.EventType.incorrect;\n      this.CTAT_ACTION =\n        iframe_content.CTAT.Component.Base.Tutorable.EventType.action;\n\n      console.log(\"INITIALIZED!\");\n      this.init_callback(this);\n    } else {\n      // term_print('\\x1b[0;30;47m' + \"BLEHH2\" + '\\x1b[0m');\n      console.log(\"BLEHH2\");\n      window.setTimeout(() => {\n        this._triggerWhenInitialized();\n      }, 500);\n    }\n  }\n\n  handle_user_set_state(evt) {\n    var sai = evt.detail.sai;\n    var sel = sai.getSelection();\n\n    // var elm = );\n    // elm = this.iframe_content.document.getElementById(sai.getSelection());\n    // console.log(sai.getInput())\n    if (sai.getInput() != \"\") {\n      this.colorElement(sel, \"START_STATE\");\n      //elm.firstChild.classList.add(\"CTAT--AL_start\");\n      this.start_state_elements.push(sel);\n    } else {\n      // elm.firstChild.classList.remove(\"CTAT--AL_start\");\n      this.colorElement(sel, \"DEFAULT\");\n      if (this.start_state_elements.includes(sel)) {\n        this.start_state_elements.remove(sel);\n      }\n    }\n  }\n\n  enterSetStartStateMode() {\n    this.start_state_elements = [];\n    this.iframe_content.document.addEventListener(\n      this.CTAT_ACTION,\n      this.handle_user_set_state\n    );\n  }\n\n  exitSetStartStateMode() {\n    this.iframe_content.document.removeEventListener(\n      this.CTAT_ACTION,\n      this.handle_user_set_state\n    );\n\n    console.log(\"START DONE\");\n    for (var i in this.start_state_elements) {\n      var sel = this.start_state_elements[i];\n      var elm = this.iframe_content.document.getElementById(sel);\n      if (elm.firstChild.value) {\n        this.lockElement(sel);\n        // elm.setAttribute(\"data-ctat-enabled\",\"false\")\n        // elm.firstChild.setAttribute(\"contentEditable\",\"false\")\n        // elm.firstChild.disabled = true;\n      }\n      this.colorElement(sel, \"DEFAULT\");\n      // elm.firstChild.classList.remove(\"CTAT--AL_start\");\n      // console.log(\"BOOP\",elm);\n    }\n    //Take away focus from whatever is there so it isn't treated as an example\n    // document.activeElement.blur();\n    // console.log(\"STAT\",get_state())\n    this.start_state_history.push(this.get_state());\n    // last_action = proposed_SAI = null;\n  }\n\n  handleUserExample(evt) {\n    this.handleUserInput(evt, \"EXAMPLE\");\n  }\n  handleUserAttempt(evt) {\n    this.handleUserInput(evt, \"ATTEMPT\");\n  }\n\n  handleUserInput(evt, type) {\n    var sai = evt.detail.sai;\n    var sel = sai.getSelection();\n\n    var elm = this.iframe_content.document.getElementById(sel);\n    if (elm.firstChild.contentEditable == \"false\") {\n      console.log(\"BAIL\");\n      return;\n    }\n\n    var sai = {\n      selection: sai.getSelection(),\n      action: sai.getAction(),\n      inputs: { value: sai.getInput() }\n    };\n\n    this.lockElement(sel);\n    this.colorElement(sel, type);\n\n    // if(this.state.mode == \"train\"){\n    if (type == \"EXAMPLE\") {\n      this.props.interactions_service.send({\n        type: \"DEMONSTRATE\",\n        data: { ...sai, reward: 1 }\n      });\n    } else if (type == \"ATTEMPT\") {\n      console.log(\"SEND ATTEMPT\", sai);\n      this.props.interactions_service.send({\n        type: \"ATTEMPT\",\n        data: { ...sai }\n      });\n    } else {\n      throw \"uknown type given\";\n    }\n    // }else if(this.state.mode == \"tutor\"){\n    //   this.props.interactions_service.send({\n    //     type : \"ATTEMPT\",\n    //     data : {...sai,reward : 1},\n    //   });\n    // }\n  }\n\n  displayCorrectness(context, event) {\n    var sai = context.staged_SAI;\n    var sel = sai.selection;\n    if (event.data == 1) {\n      this.colorElement(sel, \"CORRECT\");\n    } else {\n      this.colorElement(sel, \"INCORRECT\");\n      this.unlockElement(sel);\n    }\n  }\n\n  _done_clicked_example(evt) {\n    this.handleUserExample({\n      detail: {\n        sai: new this.iframe_content.CTATSAI(\"done\", \"ButtonPressed\", \"-1\")\n      }\n    });\n  }\n\n  enterFeedbackMode() {\n    this.iframe_content.document.addEventListener(\n      this.CTAT_ACTION,\n      this.handleUserExample\n    );\n    this.iframe_content.document\n      .getElementById(\"done\")\n      .addEventListener(\"click\", this._done_clicked_example);\n  }\n\n  exitFeedbackMode() {\n    this.iframe_content.document.removeEventListener(\n      this.CTAT_ACTION,\n      this.handleUserExample\n    );\n    this.iframe_content.document\n      .getElementById(\"done\")\n      .removeEventListener(\"click\", this._done_clicked_example);\n  }\n\n  _done_clicked_attempt(evt) {\n    this.handleUserAttempt({\n      detail: {\n        sai: new this.iframe_content.CTATSAI(\"done\", \"ButtonPressed\", \"-1\")\n      }\n    });\n  }\n\n  enterTutoringMode() {\n    this.iframe_content.document.addEventListener(\n      this.CTAT_ACTION,\n      this.handleUserAttempt\n    );\n    this.iframe_content.document\n      .getElementById(\"done\")\n      .addEventListener(\"click\", this._done_clicked_attempt);\n  }\n\n  exitTutoringMode() {\n    this.iframe_content.document.removeEventListener(\n      this.CTAT_ACTION,\n      this.handleUserAttempt\n    );\n    this.iframe_content.document\n      .getElementById(\"done\")\n      .removeEventListener(\"click\", this._done_clicked_attempt);\n  }\n\n  handle_foci_select(evt) {\n    console.log(\"FOCI SELECT!\");\n    for (var ele of evt.path) {\n      console.log(\"EELE\", ele);\n      if (\n        ele.classList != undefined &&\n        ele.classList.contains(\"CTATComponent\")\n      ) {\n        var indx = this.current_foci.indexOf(ele);\n        // console.log(current_foci)\n        if (indx == -1) {\n          this.current_foci.push(ele);\n          this.highlightElement(ele.id, 1);\n          // ele.classList.add(\"CTAT--AL_highlight1\");\n        } else {\n          this.current_foci.splice(indx, 1);\n          // ele.classList.remove(\"CTAT--AL_highlight1\");\n          this.unhighlightElement(ele.id);\n        }\n        console.log(this.current_foci);\n\n        break;\n      }\n    }\n  }\n\n  enterFociMode() {\n    console.log(\"FOCI START!\");\n    this.unhighlightAll();\n    this.current_foci = [];\n    this.iframe_content.document.addEventListener(\n      \"click\",\n      this.handle_foci_select\n    );\n  }\n\n  get_current_foci() {\n    if (this.current_foci) {\n      return this.current_foci.map(elm => elm.id);\n    } else {\n      return [];\n    }\n  }\n\n  exitFociMode() {\n    this.unhighlightAll();\n    console.log(\"FOCI DONE!\");\n    // var foci_of_attention = [];\n    // for(var ele of this.current_foci){\n    //     // ele.classList.remove(\"CTAT--AL_highlight1\");\n    //     this.colorElement(ele.id)\n    //     // foci_of_attention.push(ele.id);\n    // }\n    // console.log(foci_of_attention)\n    // current_sai_data.foci_of_attention = foci_of_attention;\n    this.current_foci = [];\n    this.iframe_content.document.removeEventListener(\n      \"click\",\n      this.handle_foci_select\n    );\n  }\n\n  _shouldSkipTraining(sai) {\n    if (!this.state.steps && !this.state.selections) {\n      return false;\n    }\n\n    if (this.state.steps) {\n      var tracer = this.iframe_content.CTAT.ToolTutor.tutor.getTracer();\n      var stepId = tracer.getLastResult().getStepID();\n      console.log(\"stepId:\", stepId);\n\n      if (this.state.steps.includes(stepId)) {\n        return false;\n      }\n    }\n\n    if (this.state.selections &&\n        this.state.selections.includes(sai.selection)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  //---------- Xstate API with promises ----------------\n  attemptStagedSAI(context, event) {\n    const promise = new Promise((resolve, reject) => {\n      // try {\n      const sai = context.staged_SAI;\n      var currentElement = this.iframe_content.document.getElementById(\n        sai.selection\n      );\n      const CTAT_CORRECT = this.CTAT_CORRECT;\n      const CTAT_INCORRECT = this.CTAT_INCORRECT;\n      const shouldSkipTraining = this._shouldSkipTraining;\n      const lockElement = this.lockElement;\n\n      function handle_ctat_feedback(evt) {\n        console.log(\"EVENT\", evt);\n        console.log(\"EVENT\", evt.detail.sai.getTransactionID());\n        currentElement.removeEventListener(CTAT_CORRECT, handle_ctat_feedback);\n        currentElement.removeEventListener(\n          CTAT_INCORRECT,\n          handle_ctat_feedback\n        );\n\n        //If in test mode make sure that fields are locked on incorrect\n        console.log(\"MOOOOOOOO\", context)\n        if(context.test_mode){\n          lockElement(sai.selection)\n        }\n\n        resolve({\n          ...sai,\n          reward: evt.type == CTAT_CORRECT ? 1 : -1,\n          skipTraining: shouldSkipTraining(sai)\n        });\n      }\n\n      currentElement.addEventListener(CTAT_CORRECT, handle_ctat_feedback);\n      currentElement.addEventListener(CTAT_INCORRECT, handle_ctat_feedback);\n      this.applySAI(sai);\n      // }catch(err){\n      //   reject(err)\n      // }\n    });\n    return promise;\n  }\n  applyNextExample(context, event) {\n    const promise = new Promise((resolve, reject) => {\n      // try{\n      this.applyHint();\n      var sai = this.getDefaultSAI();\n      this.colorElement(sai.selection, \"EXAMPLE\");\n      this.applySAI(sai);\n      resolve({\n        ...sai,\n        reward: 1,\n        skipTraining: this._shouldSkipTraining(sai)\n      });\n      //   }catch(err){\n      //     reject(err)\n      //   }\n    });\n    return promise;\n  }\n  //----------------------------------------------------\n\n  applySAI(sai) {\n    var sel_elm = this.iframe_content.document.getElementById(sai.selection);\n    if ((sel_elm[\"data-ctat-enabled\"] || \"true\") == \"false\") {\n      //Force incorrect if try to edit uneditaable\n      var incorrect_event = new CustomEvent(this.CTAT_INCORRECT, {\n        detail: { sai: sai, component: sel_elm },\n        bubbles: true,\n        cancelable: true\n      });\n      sel_elm.dispatchEvent(incorrect_event);\n    }\n\n    if (sai.action == \"ButtonPressed\") {\n      sai.inputs = { value: -1 };\n    }\n\n    // last_action = sai\n    const CTATSAI = this.iframe_content.CTATSAI;\n    var sai_obj = new CTATSAI(sai.selection, sai.action, sai.inputs[\"value\"]);\n    this.iframe_content.CTATCommShell.commShell.processComponentAction(\n      sai_obj,\n      true\n    );\n  }\n\n  lockElement(name) {\n    var comp = this.iframe_content.CTATShellTools.findComponent(name)[0];\n    comp.setEnabled(false);\n  }\n\n  unlockElement(name) {\n    var comp = this.iframe_content.CTATShellTools.findComponent(name)[0];\n    comp.setEnabled(true);\n  }\n\n  colorElement(name, type) {\n    var elm = this.iframe_content.document.getElementById(name);\n    // if(type == \"DEFAULT\"){\n    //   for (const [key, value] of Object.entries(this.color_class_map)) {\n    //     if(elm.firstElementChild.classList.contains(value)){\n    //       elm.firstElementChild.classList.remove(value);\n    //     }\n    //   }\n    // }else{\n    // this.colorElement(name,\"DEFAULT\")\n    if (elm && elm.firstElementChild) {\n      elm.firstElementChild.setAttribute(\"class\", this.color_class_map[type]);\n    }\n    // elm.firstElementChild.classList.add(this.color_class_map[type]);\n    //   }\n  }\n\n  // highlightSAI(sai){\n\n  //   if(sai.mapping){\n  //       Object.entries(sai.mapping).forEach(function(v,index){\n  //           const [var_str, elem_str] = v\n  //           var colorIndex = 1\n  //           if(var_str != \"?sel\"){\n  //               colorIndex = 2 + ((index-1) % (this.where_colors.length-1));\n  //               console.log(colorIndex)\n  //           }\n  //           // elm = this.iframe_content.document.getElementById(elem_str.replace('?ele-',\"\"));\n  //           this.highlightElement(elem_str,colorIndex)\n  //       });\n  //   }else{\n  //     alert(\"IDK WHAT THIS IS\")\n  //       // this.highlighted_elements.push(elm.firstElementChild.id)\n  //       // elm.firstElementChild.classList.add(\"CTAT--AL_highlight1\")\n  //   }\n  // }\n\n  highlightElement(name, colorIndex = 1) {\n    this.unhighlightElement(name);\n    var elm = this.iframe_content.document.getElementById(\n      name.replace(\"?ele-\", \"\")\n    );\n    elm.firstElementChild.classList.add(\"CTAT--AL_highlight\" + colorIndex);\n    this.highlighted_elements.push(name);\n    // console.log(\"H\", this.highlighted_elements)\n  }\n\n  unhighlightElement(name) {\n    if (this.highlighted_elements.includes(name)) {\n      var elm = this.iframe_content.document.getElementById(\n        name.replace(\"?ele-\", \"\")\n      );\n      var before = elm.firstElementChild.classList.toString();\n      for (var i = 1; i <= this.where_colors.length; i++) {\n        var c = \"CTAT--AL_highlight\" + i;\n        // console.log(c)\n        if (elm.firstElementChild.classList.contains(c)) {\n          elm.firstElementChild.classList.remove(c);\n        }\n      }\n      var after = elm.firstElementChild.classList.toString();\n      // console.log(\"BEF-AFT:\", before,after)\n      var index = this.highlighted_elements.indexOf(name);\n      if (index > -1) {\n        this.highlighted_elements.splice(index, 1);\n      }\n    }\n  }\n\n  clearElement(name) {\n    var elm = this.iframe_content.document.getElementById(name);\n    elm.firstElementChild.value = \"\";\n  }\n\n  highlightSAI(sai) {\n    if (sai.mapping) {\n      var index = 0;\n      for (var var_str in sai.mapping) {\n        var elem_str = sai.mapping[var_str];\n        var colorIndex = 1;\n        if (var_str != \"?sel\") {\n          colorIndex = 2 + ((index - 1) % (this.where_colors.length - 1));\n          // console.log(colorIndex)\n        }\n        // elm = this.iframe_content.document.getElementById(elem_str.replace('?ele-',\"\"));\n        this.highlightElement(elem_str, colorIndex);\n        index++;\n      }\n    } else {\n      alert(\"RESPONSE IS MISSING FIELD:'mapping'\");\n      // this.highlighted_elements.push(elm.firstElementChild.id)\n      // elm.firstElementChild.classList.add(\"CTAT--AL_highlight1\")\n    }\n  }\n\n  unhighlightAll() {\n    // console.log(\"HIGHLIGHTED_/\", this.highlighted_elements)\n    for (var elem_str of [...this.highlighted_elements]) {\n      this.unhighlightElement(elem_str);\n    }\n  }\n\n  getDefaultSAI() {\n    var sai = this.graph\n      .getExampleTracer()\n      .getBestNextLink()\n      .getDefaultSAI();\n    sai = {\n      selection: sai.getSelection(),\n      action: sai.getAction(),\n      inputs: { value: sai.getInput() }\n    };\n    return sai;\n  }\n\n  clearProposedSAI() {\n    if (this.proposed_SAI) {\n      this.clearElement(this.proposed_SAI.selection);\n      this.unlockElement(this.proposed_SAI.selection.replace(\"?ele-\", \"\"));\n      this.unhighlightAll();\n      this.proposed_SAI = null;\n    }\n  }\n\n  proposeSAI(sai) {\n    // console.log(\"EVDA\", event.data)\n    // var sai = event.data\n    this.clearProposedSAI();\n    this.proposed_SAI = { ...sai };\n    this.highlightSAI(sai);\n    this.stageSAI(sai);\n  }\n\n  stageSAI(sai) {\n    var comp = this.iframe_content.CTATShellTools.findComponent(\n      sai.selection\n    )[0];\n    var sai_obj = new this.iframe_content.CTATSAI(\n      sai.selection,\n      sai.action,\n      sai.inputs[\"value\"]\n    );\n    comp.executeSAI(sai_obj);\n    this.lockElement(sai.selection);\n  }\n\n  confirmProposedSAI() {\n    if (this.proposed_SAI) {\n      this.unhighlightAll();\n      this.proposed_SAI = null;\n    }\n  }\n\n  applyHint() {\n    var message =\n      \"<message><properties>\" +\n      \"<MessageType>InterfaceAction</MessageType>\" +\n      \"<Selection><value>hint</value></Selection>\" +\n      \"<Action><value>ButtonPressed</value></Action>\" +\n      \"<Input><value><![CDATA[hint request]]></value></Input>\" +\n      \"</properties></message>\";\n    // console.log(\"MESSAGE\",message);\n    this.commLibrary.sendXML(message);\n  }\n\n  get_state({\n    encode_relative = true,\n    strip_offsets = true,\n    use_offsets = true,\n    use_class = true,\n    use_id = true,\n    append_ele = true,\n    numeric_values = false\n  } = {}) {\n    var relative_pos_cache = this.relative_pos_cache;\n    var HTML_PATH = this.HTML_PATH;\n    var state_array = this.iframe_content.$(\"div\").toArray();\n    // state_array.push({current_task: current_task});\n\n    var state_json = {};\n    var count = 0;\n    $.each(state_array, function(idx, element) {\n      obj = {};\n      if (\n        element.classList.contains(\"CTATComponent\") &&\n        !element.classList.contains(\"CTATTable\")\n      ) {\n        // if(obj[\"className\"] == \"CTATTextField\") {continue;} //Skip table objects and just use cells\n        if (element.classList[0] != \"CTATTextField\") {\n          //Skip text fields\n          if (use_class) {\n            obj[\"type\"] = element.classList[0];\n          }\n          if (use_offsets) {\n            obj[\"offsetParent\"] = element.offsetParent.dataset.silexId;\n            obj[\"offsetLeft\"] = element.offsetLeft;\n            obj[\"offsetTop\"] = element.offsetTop;\n            obj[\"offsetWidth\"] = element.offsetWidth;\n            obj[\"offsetHeight\"] = element.offsetHeight;\n          }\n\n          if (use_id) {\n            obj[\"id\"] = element.id;\n          }\n\n          if (\n            checkTypes(element, [\n              \"CTATTextInput\",\n              \"CTATComboBox\",\n              \"CTATTable--cell\"\n            ])\n          ) {\n            obj[\"value\"] = element.firstElementChild.value;\n            if (numeric_values) {\n              obj[\"value\"] = Number(obj[\"value\"]) || obj[\"value\"];\n            }\n            obj[\"contentEditable\"] =\n              element.firstElementChild.contentEditable == \"true\";\n            // obj[\"name\"] = element.id\n          }\n          // if(checkTypes(element, [\"CTATTextField\", \"CTATComboBox\"])){\n          //  obj[\"textContent\"] = element.textContent;\n          // }\n\n          if (checkTypes(element, [\"CTATComboBox\"])) {\n            // if(element.options){\n            //Probably not the best\n            var options = element.firstElementChild.options;\n            var temp = [];\n            for (var i = 0; i < options.length; i++) {\n              temp.push(options[i].text);\n            }\n            obj[\"options\"] = Object.assign({}, temp);\n\n            // }\n          }\n          let name = (append_ele ? \"?ele-\" : \"\") + element.id;\n          // console.log(name,append_ele)\n          state_json[name] = obj;\n          count++;\n        }\n      }\n      // add question marks for apprentice\n      // element = jQuery.extend({}, element);\n      // element = jQuery.data(element);\n      // if(element && !jQuery.isEmptyObject(element) && element.CTATComponent){\n      //  console.log(\"ELEEMENT\", element);\n      //  // element = jQuery.data(element.CTATComponent);\n      //  element = element.CTATComponent;\n      //  // if(element.CTATComponent){\n      //    // element.CTATComponent = jQuery.data(element.CTATComponent);\n      //  // }\n      //  console.log(\"KEY \", idx, element.className);\n      //  state_json[\"?ele-\" + idx] = element;\n      //  count++;\n      // }\n\n      // element.component = jQuery.data(element.component);\n\n      // if(element.hasAttribute(\"removeData\") ){\n      //  element.removeData();\n      //  console.log(\"WOOOPS\");\n      // }\n    });\n\n    // Gets lists of elements that are to the left, right and above the current element\n    if (encode_relative) {\n      const elm_list = Object.entries(state_json);\n      // console.log(elm_list);\n\n      var rel_objs;\n      if (!(HTML_PATH in relative_pos_cache)) {\n        rel_objs = {};\n        for (var i = 0; i < elm_list.length; i++) {\n          // console.log(elm_list[i][0])\n          rel_objs[elm_list[i][0]] = {\n            to_left: [],\n            to_right: [],\n            above: [],\n            below: []\n          };\n        }\n\n        for (var i = 0; i < elm_list.length; i++) {\n          for (var j = 0; j < elm_list.length; j++) {\n            if (i != j) {\n              var [a_n, a_obj] = elm_list[i];\n              var [b_n, b_obj] = elm_list[j];\n              if (\n                a_obj.offsetTop > b_obj.offsetTop &&\n                a_obj.offsetLeft < b_obj.offsetLeft + b_obj.offsetWidth &&\n                a_obj.offsetLeft + a_obj.offsetWidth > b_obj.offsetLeft\n              ) {\n                var dist = a_obj.offsetTop - b_obj.offsetTop;\n                rel_objs[a_n][\"above\"].push([b_n, dist]);\n                rel_objs[b_n][\"below\"].push([a_n, dist]);\n              }\n              if (\n                a_obj.offsetLeft < b_obj.offsetLeft &&\n                a_obj.offsetTop + a_obj.offsetHeight > b_obj.offsetTop &&\n                a_obj.offsetTop < b_obj.offsetTop + b_obj.offsetHeight\n              ) {\n                var dist = b_obj.offsetLeft - a_obj.offsetLeft;\n                rel_objs[a_n][\"to_right\"].push([b_n, dist]);\n                rel_objs[b_n][\"to_left\"].push([a_n, dist]);\n\n                // console.log(a_n,b_n,dist)\n              }\n            }\n          }\n        }\n\n        var grab1st = function(x) {\n          return x[0];\n        };\n        var compare2nd = function(x, y) {\n          return x[1] - y[1];\n        };\n        var grabN = function(x, n) {\n          let out = [];\n          for (var i = 0; i < n; i++) {\n            if (i < x.length) {\n              out.push(x[i]);\n            } else {\n              out.push(null);\n            }\n          }\n          return out;\n        };\n        for (var i = 0; i < elm_list.length; i++) {\n          var rel_obj = rel_objs[elm_list[i][0]];\n          // rel_obj[\"below\"] = rel_obj[\"below\"].sort(compare2nd).map(grab1st).join(' ');\n          // rel_obj[\"above\"] = rel_obj[\"above\"].sort(compare2nd).map(grab1st).join(' ');\n          // rel_obj[\"to_right\"] = rel_obj[\"to_right\"].sort(compare2nd).map(grab1st).join(' ');\n          // rel_obj[\"to_left\"] = rel_obj[\"to_left\"].sort(compare2nd).map(grab1st).join(' ');\n          // console.log(elm_list[i], rel_obj[\"to_left\"].sort(compare2nd))\n          rel_obj[\"below\"] =\n            rel_obj[\"below\"].sort(compare2nd).map(grab1st)[0] || \"\";\n          rel_obj[\"above\"] =\n            rel_obj[\"above\"].sort(compare2nd).map(grab1st)[0] || \"\";\n          rel_obj[\"to_right\"] =\n            rel_obj[\"to_right\"].sort(compare2nd).map(grab1st)[0] || \"\";\n          rel_obj[\"to_left\"] =\n            rel_obj[\"to_left\"].sort(compare2nd).map(grab1st)[0] || \"\";\n\n          // rel_obj[\"below\"] = grabN(rel_obj[\"below\"].sort(compare2nd).map(grab1st),2);\n          // rel_obj[\"above\"] = grabN(rel_obj[\"above\"].sort(compare2nd).map(grab1st),2);\n          // rel_obj[\"to_right\"] = grabN(rel_obj[\"to_right\"].sort(compare2nd).map(grab1st),2);\n          // rel_obj[\"to_left\"] = grabN(rel_obj[\"to_left\"].sort(compare2nd).map(grab1st),2);\n        }\n\n        // console.log(rel_objs)\n        relative_pos_cache[HTML_PATH] = rel_objs;\n      } else {\n        rel_objs = relative_pos_cache[HTML_PATH];\n      }\n\n      for (var i = 0; i < elm_list.length; i++) {\n        var obj = state_json[elm_list[i][0]];\n        var rel_obj = rel_objs[elm_list[i][0]];\n        // console.log(rel_obj)\n        // console.log(elm_list[i][0])\n        // console.log(relative_pos_cache[HTML_PATH])\n\n        obj[\"below\"] = rel_obj[\"below\"];\n        obj[\"above\"] = rel_obj[\"above\"];\n        obj[\"to_right\"] = rel_obj[\"to_right\"];\n        obj[\"to_left\"] = rel_obj[\"to_left\"];\n        if (strip_offsets) {\n          delete obj[\"offsetTop\"];\n          delete obj[\"offsetLeft\"];\n          delete obj[\"offsetWidth\"];\n          delete obj[\"offsetHeight\"];\n        }\n\n        state_json[elm_list[i][0]] = obj;\n      }\n    }\n\n    console.log(\"STATE JSON\", state_json);\n    return state_json;\n  }\n\n  // state_update(state){\n\n  // }\n\n  // webview_loaded(message){\n  //   console.log(message)\n  //   var d = message.nativeEvent.data;\n  //   console.log(\"document&:\",d)\n  //   console.log(document.getElementsByClassName('background-initial'))\n  //   // window.document.domain = \"http://0.0.0.0:8000\"\n  // }\n\n  // setRef = webview => {\n  //   this.ctat_webview = webview;\n  // }\n  render() {\n    return (\n      <WebView\n        //title=\"hey\"\n        ///*ref={function(webview) {window.ctat_webview = webview;*/}\n        //                        this.iframe_content = webview.frameRef.contentWindow;\n        //                        console.log(\"THIS\",this)\n        //                        // this.graph = this.iframe_content.CTAT.ToolTutor.tutor.getGraph() || false;\n        //                       console.log(\"MOOP\",webview)}}\n        ref={this.ctat_webview}\n        // style={{ height: 700, width: 400 }}\n        originWhitelist={[\"*\"]}\n        // source={{\"uri\": \"http://0.0.0.0:8000/HTML/fraction_arithmetic.html?question_file=../mass_production/mass_production_brds/AD 5_9_plus_3_7.brd\"}}\n        source={this.state.source}\n        onLoad={this.state.onLoad}\n        // source={{\"html\": \"<!DOCTYPE html><html><head></head><body> HERE IS THE TUTOR... ARE YOU LEARNING YET? </body></html>\"}}\n        // source={{\"html\": \"<? echo file_get_contents('http://0.0.0.0:8000/HTML/fraction_arithmetic.html'); ?>\"}}\n        // injectedJavaScript={\"window.booger = document\"}\n        // onMessage={this.webview_loaded}\n      />\n    );\n  }\n}\n\nconst LOAD_SCREEN =\n  '<!DOCTYPE html> \\\n<html>\\\n<head>\\\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\\n<style>\\\n.loader {\\\n  border: 16px solid #f3f3f3;\\\n  border-radius: 50%;\\\n  border-top: 16px solid #3498db;\\\n  width: 120px;\\\n  height: 120px;\\\n  -webkit-animation: spin 2s linear infinite; /* Safari */\\\n  animation: spin 2s linear infinite;\\\n  position: absolute;\\\n  left: 50%;\\\n  top: 50%;\\\n  transform: translate(-50%, -50%);*/\\\n}\\\n\\\n/* Safari */\\\n@-webkit-keyframes spin {\\\n  0% { -webkit-transform: rotate(0deg); }\\\n  100% { -webkit-transform: rotate(360deg); }\\\n}\\\n\\\n@keyframes spin {\\\n  0% { transform: rotate(0deg); }\\\n  100% { transform: rotate(360deg); }\\\n}\\\n</style>\\\n</head>\\\n<body>\\\n\\\n<h2>How To Create A Loader</h2>\\\n\\\n<div class=\"loader\"></div>\\\n\\\n</body>\\\n</html>\\\n';\n\nexport default CTAT_Tutor;\n","// import Accordion from 'react-native-collapsible/Accordion';\n// import { CollapsingToolbar }  from 'react-native-collapsingtoolbar';\n// import CollapsibleList from './collapsible_list.js'\nimport SkillPanel from './components/skill_panel.js'\nimport Buttons from './components/buttons';\n// import { vw, vh, vmin, vmax } from 'react-native-expo-viewport-units';\n// import ButtonsMachine from './interactions.js'\nimport {build_interactions_sm} from './interactions.js'\nimport {build_training_sm, problem_props} from './training_handler.js'\nimport NetworkLayer from './network_layer.js'\nimport { interpret } from 'xstate';\nimport autobind from 'class-autobind';\nimport path from 'path';\nimport pick from 'object.pick';\n\n// \nimport React from 'react';\n// import { View, Text, StyleSheet } from \"react-native\";\n// import logo from './logo.svg';\n// import './App.css';\n\nimport { TouchableHighlight,ScrollView,View, Text, Platform, StyleSheet,SectionList,AppRegistry } from \"react-native\";\n\n\n// const instructions = Platform.select({\n//   ios: \"Press Cmd+R to reload,\\n\" + \"Cmd+D or shake for dev menu\",\n//   android:\n//     \"Double tap R on your keyboard to reload,\\n\" +\n//     \"Shake or press menu button for dev menu\",\n//   web: \"Your browser will automatically refresh as soon as you save the file.\"\n// });\n// var state_machine = ButtonsMachine.initialState\n// var state_machine_service = interpret(ButtonsMachine)\n// state_machine_service.start()\n\n// var NonInteractive_SM = build_SM_NonInteractive()\n// var ctat_state_machine = NonInteractive_SM.initialState\n// var ctat_state_machine_service = interpret(NonInteractive_SM)\n// ctat_state_machine_service.start()\n// window.ctat_state_machine = ctat_state_machine\n// window.ctat_state_machine_service = ctat_state_machine_service\n\n// var urlParams = new URLSearchParams(window.location.search);\n// var AL_URL = urlParams.get('al_url');\n// var HOST_URL = window.location.origin\n// window.network_layer = new NetworkLayer(AL_URL,HOST_URL)\n\n// ctat_state_machine_service.onTr\n\n// ctat_state_machine_service.onTransition(current => {\n//     setButtonsState(current,window.debugmode)\n    \n//     // this.setState({ current : current })\n//     }\n//   );\nfunction shallow_diff(o1,o2,keys=null){\n  console.log(keys)\n  let diff = Object.keys(o2).reduce((diff, key) => {\n      if (o1[key] !== o2[key] && (keys == null || keys.includes(key))){\n        diff[key] = o2[key]\n      }\n      return diff\n    }, {})\n  return diff\n}\n\n\n\nexport default class ALReactInterface extends React.Component {\n  constructor(props){\n    super(props);\n    autobind(this);\n    this.onInteractionTransition = this.onInteractionTransition.bind(this)\n    // this.urlParams = new URLSearchParams(window.location.search);\n\n    // this.AL_URL = this.urlParams.get('al_url');\n    // this.HOST_URL = window.location.origin\n    // console.log(this.AL_URL + '/create/',this.HOST_URL)\n    this.network_layer = new NetworkLayer(props.AL_URL,props.HOST_URL,props.OUTER_LOOP_URL)\n    \n    // this.training_file = this.urlParams.get('training');\n    // this.interactive = this.urlParams.get('interactive') == \"true\";\n    // this.use_foci = this.urlParams.get('use_foci') == \"true\";\n\n    // var working_dir = this.urlParams.get('wd')\n    if(props.working_dir == null && props.training_file != null){\n        var match = props.training_file.match(/(.*)[\\/\\\\]/)\n        props.working_dir =  !!match ? match[1] : ''; //The directory of the training.json\n    }\n    this.tutor = React.createRef()\n    this.skill_panel = React.createRef()\n    this.buttons = React.createRef()\n\n    this.state = {\n      default_props: {},\n      buttons_props: {app: this},\n      tutor_props: this.props.tutor_props || {},\n      skill_panel_props: {},\n      \"training_description\" : \"????\",\n      \"agent_description\" : \"????\",\n      \"problem_description\" : \"????\",\n\n      \"interactive\" : this.props.interactive,\n      \"free_author\" : this.props.free_author,\n      \"tutor_mode\" : this.props.tutor_mode,\n    }\n    // this.state = {prob_obj : null};\n  }\n\n  onInteractionTransition(current){\n    console.log(\"#\",current.value, \":\", current.context, current)\n\n    var standard_props = {interactions_state: current,\n                          interactions_service : this.interactions_service}\n    this.setState({\n      default_props : standard_props\n      // buttons_props: standard_props,\n      // tutor_props: standard_props,\n      // skill_panel_props: standard_props,\n    })\n  }\n\n  onTrainingTransition(current){\n    var c = current.context\n    console.log(\"&\", \"HEY THIS IS THIS THING\")\n    if(!c.interactive){\n      this.setState({\n        training_description : c.training_description || \"???\",\n        agent_description : c.agent_description || \"???\",\n        problem_description : c.problem_description || \"???\"\n      })  \n    }\n    \n\n  }\n\n  changeInteractionMode(d){\n    this.setState(d)\n  }\n\n  componentDidUpdate(prevProps,prevState){\n\n    //Update from changeInteractionMode\n    var d = shallow_diff(prevState,this.state,[\"interactive\",\"free_author\",\"tutor_mode\"])\n    if(Object.keys(d).length > 0){\n      console.log(\"componentDidUpdate\", d)\n      this.training_service.send({\n        type : \"CHANGE_INTERACTION_MODE\",\n        data : d,\n      })  \n    }\n  }\n\n  componentDidMount(){\n    console.log(\"MOUNTED\")\n    var tutor, nl, wd,tf\n    [tutor, nl, wd,tf] = [this.tutor.current,this.network_layer,this.props.working_dir,this.props.training_file]\n    \n\n    // this.setState({\n     \n    // })\n    this.interactions_sm = build_interactions_sm(this,\n                                                 pick(this.props,problem_props))\n                                                 // this.props.interactive,\n                                                 // this.props.free_author,\n                                                 // this.props.tutor_mode)  \n    this.interactions_service = null //Will be spawned in training_sm \n\n    this.training_machine = build_training_sm(this,this.interactions_sm, tf, wd)\n    this.training_service = interpret(this.training_machine)\n    this.training_service.onTransition(this.onTrainingTransition)\n    this.training_service.start()\n\n    const sub = this.training_service.subscribe(state => {\n      console.log(\"SUBSCRIBE:\",state);\n    });\n    console.log(\"T MACHINE!\", this.training_service)\n\n    window.setTutorMode = (x) => {\n      this.changeInteractionMode({\"tutor_mode\" : x})\n    }\n\n    window.setInteractive = (x) => {\n      this.changeInteractionMode({\"interactive\" : x})\n    }\n\n    window.setFreeAuthor = (x) => {\n      this.changeInteractionMode({\"free_author\" : x})\n    }\n\n    //TODO MOVE TO NW_LAYER\n    window.generateBehaviorProfile = this.generateBehaviorProfile\n\n\n  }\n\n  generateBehaviorProfile(ground_truth_path=\"/ground_truth.json\",out_dir=\"\"){\n    // window.generateBehaviorProfile = (ground_truth_path,out_dir=\"\") => {\n    let f = this.network_layer.generateBehaviorProfile\n\n    let t_context = this.training_service._state.context\n    // let i_context = this.training_service.context\n    if(ground_truth_path != null){\n\n      let to_json_list = (in_list) => {\n        let out = []\n        for (let line of in_list){\n          if(line != \"\"){\n            let json = JSON.parse(line)\n            out.push(json)\n          }\n        }\n        return out;\n      }\n      // let rq_h = this.network_layer.return\n      // let path =  ground_truth_path\n      if(ground_truth_path[0] != \"/\"){\n        ground_truth_path = (t_context.working_dir|| \"/\") + ground_truth_path\n      }\n      return fetch(ground_truth_path)\n        .then((resp) => resp.text())\n        .then((text) => text.split(\"\\n\"))\n        .then((split) => to_json_list(split))\n        .then((resps) => f(t_context,{data:{requests:resps,out_dir: out_dir}}))\n\n    }else{\n      return f(t_context)  \n    }\n      \n  }\n\n  render(){\n    const Tutor = this.props.tutorClass\n\n    var lower_display;\n    var use_prompt = false\n    if(!this.state.interactive){\n      use_prompt = true\n      var prompt_text\n      // if(this.state.tutor_mode == true){\n      //   prompt_text = \"TUTOR MODE\\n\"\n      // }else if(!this.state.interactive){\n      prompt_text = \n        this.state.training_description + \"\\n\" +\n        this.state.agent_description + \"\\n\" +\n        this.state.problem_description + \"\\n\"\n\n      lower_display = \n      <View style={styles.prompt}>\n        <Text>\n        {prompt_text}\n        </Text>\n      </View>\n    }else{\n      lower_display = \n      <View style={styles.controls}>\n        {!this.state.tutor_mode &&\n        <View style={styles.skill_panel}>\n          <SkillPanel ref={this.skill_panel}\n          {...this.state.default_props}\n          {...this.state.skill_panel_props}/>\n        </View>\n        }\n        <View style={styles.buttons}>\n          <Buttons ref={this.buttons}\n          {...this.state.default_props}\n          {...this.state.buttons_props}\n          {...{tutor_mode: this.state.tutor_mode}}/>\n        </View>\n      </View>\n    }\n\n    return (\n  \t<View style={styles.container}>\n  \t\t<View style={styles.ctat_tutor}>\n  \t\t\t<Tutor\n          //tutor_props = {this.state.prob_obj}\n          ref={this.tutor}//{function(tutor) {window.tutor = tutor; console.log(\"TUTOR IS:\",tutor)}}\n          id=\"tutor_iframe\"\n          //current_state={ctat_state_machine}\n          //sm_service={ctat_state_machine_service}\n          interactive={false}\n          {...this.state.default_props}\n          {...this.state.tutor_props}\n        />\n  \t\t</View>\n  \t\t{lower_display}\n  \t</View>\n    );\n  }\n}\n\n//current={state_machine}\n//service={state_machine_service}\n//debugmode={true}\n//callbacks={window.button_callbacks}\n//nools_callback={window.nools_callback}/>\n\nconst styles = StyleSheet.create({\n\t     container : {\n        // justifyContent: \"stretch\",\n        // padding: 20,\n        // alignItems:'center',\n        // backgroundColor: \"blue\",\n        flex: 1,\n        flexDirection: \"column\",\n        // flexWrap: \"wrap\"\n      },\n      ctat_tutor: {\n\n      \t// backgroundColor: 'powderblue',\n      \t\n      \t// flexGrow: 1,\n      \t// height : \"65%\",\n      \t// width : \"100%\",\n        // width:800,\n        // height: vh(64),\n        // flexGrow: 100,\n        margin: 4,\n        flexBasis: \"65%\",\n        flex: 1,\n        \n\n      },\n      prompt : {\n        flex: 1,\n        textAlign : \"center\"\n      },\n      controls :{\n\n      \t// flexGrow: 1,\n      \t// flexBasis: 300,\n        // display: \"flex\",\n        // height : \"35%\",\n        flex: 1,\n        flexBasis: \"35%\",\n        flexDirection: \"row\",\n        // flexWrap: \"wrap\",\n        // width : 600,\n        // flexGrow: 1,\n        // flexBasis:  600,\n        // height: vh(35),\n        // justifyContent: \"center\",\n      },\n      \n      skill_panel : {\n      \t// width: \"65%\",\n      \t// height: 300,\n        // height: vh(35),\n        flex : 1,\n        flexBasis: \"60%\",\n        // flexGrow : 0\n        // flexDirection: \"row\",\n        // flexShrink: 1,\n        // flexBasis: 1\n        /*height: 320px*/\n\n      },\n      \n\n      buttons : {\n        flexGrow: 1,\n        // display: \"flex\",\n        // width : 1000,\n        // flexBasis: 2,\n        flexDirection: \"column\",\n        // height: vh(35),\n        // width: \"35%\",\n        flexBasis : \"40%\",\n        /*width:300px;*/\n        // flexWrap: \"wrap\",\n        justifySelf : \"space-around\",\n        \n        // flexBasis: 32,\n        /*justify-self:  start;*/\n        /*align-self:  ;*/\n        /*padding: 60px,*/\n        // justifyContent: \"auto\",\n        \n        // alignContent: \"center\"\n        \n      }\n\n});","import { Machine, assign, interpret } from \"xstate\";\nimport RJSON from \"relaxed-json\";\nimport { build_interactions_sm } from \"./interactions.js\";\nimport { applyPriorKnowledge } from \"./prior_knowledge.js\";\nimport { evalJSONFunc } from \"./eval.js\";\nimport { Random } from \"random-js\";\n\nvar pick = require('object.pick');\nvar fs = require(\"fs\");\n// const path = require(\"path\")\n\nconst random = new Random();\n\n//A set of properties which are passed from the training handler SM context \n//  to the interactions SM as props \nexport const problem_props = ['agent_id','free_author', \n        'interactive','tutor_mode','examples_only','test_mode']\nconst problem_props_dict = problem_props.reduce(function(obj, x) { obj[x] = null;return obj;}, {});        \n\nconst CTATGuid = {\n  s4: function s4() {\n    return Math.floor((1 + Math.random()) * 65536)\n      .toString(16)\n      .substring(1);\n  },\n  guid: function guid() {\n    return (\n      this.s4() +\n      this.s4() +\n      \"-\" +\n      this.s4() +\n      \"-\" +\n      this.s4() +\n      \"-\" +\n      this.s4() +\n      \"-\" +\n      this.s4() +\n      this.s4() +\n      this.s4()\n    );\n  }\n};\n\nfunction load_training_file(context, event) {\n  console.log(\"TRAINING JSON:\", context.training_file);\n  return fetch(context.training_file)\n    .then(response => response.text()) //response.json())\n    .then(response => RJSON.parse(response)) //response.json())\n    .then(response => Object.entries(response))\n    .then(response => {\n      return { updateContext: { training_iterator: response } };\n    });\n  // var promise = new Promise((resolve, reject) => {\n  // try{\n  // \tlet file_name = context.training_json\n  // \tlet rawdata = fs.readFileSync(file_name)\n  // \tlet training_json_obj = JSON.parse(rawdata);\n  // \tvar training_iterator = Object.entries(training_json_obj);\n  // }catch(error){\n  // \tconsole.error(error)\n  // \treject(error)\n  // }\n  // resolve(training_iterator)\n  // });\n  // return promise\n}\n\nfunction serve_next_training_set(context, event) {\n  var promise = new Promise(async (resolve, reject) => {\n    var training_iterator = context.training_iterator;\n    var file_params = context.file_params || {};\n    console.log(\"TRAINING ITERATOR\", training_iterator.length);\n    if (training_iterator.length > 0) {\n      var out = training_iterator.shift();\n      var name = out[0];\n\n      while (name == \"set_params\") {\n        file_params = { ...file_params, ...out[1] }; //join and prefer new one\n        out = training_iterator.shift();\n        name = out[0];\n      }\n\n      console.log(\"START TRAINING SET: \", name, file_params);\n      var agent_iterator = await evalJSONFunc(out[1],context);\n\n      resolve({\n        updateContext: {\n          training_iterator: training_iterator,\n          agent_iterator: agent_iterator,\n          file_params: file_params,\n          training_description:\n            context.training_file.replace(/^.*[\\\\\\/]/, \"\") + \" : \" + name\n        }\n      });\n    } else {\n      resolve(null);\n    }\n  });\n  return promise;\n}\n\nfunction parseOuterLoopController(x, problem_set = null) {\n  if (typeof x == \"string\") {\n    x = { type: x };\n  }\n  if (problem_set != null) {\n    x[\"problem_set\"] = problem_set;\n  }\n  x[\"initialized\"] = false;\n  return { outer_loop_controller: x };\n}\n\n// function resolveProblemSet(spec, context){\n// \tvar promise = new Promise( async (resolve,reject) => {\n// \t\tvar rez;\n// \t\tif(typeof(spec) == 'object'){\n//         \tspec = {...spec};\n\n// \t\t\tvar key = Object.keys(spec)[0];\n// \t\t\tvar val = spec[key]\n// \t\t\tif(key == \"concatenate\"){\n// \t\t\t\tvar all = []\n// \t\t\t\tfor(var g of val){\n// \t\t\t\t\trez = await resolveProblemSet(g,context)\n// \t\t\t\t\tall = all.concat(rez)\n// \t\t\t\t}\n// \t\t\t\tresolve(all)\n// \t\t\t}else if(key == \"shuffle\"){\n// \t\t\t\trez = await resolveProblemSet(val,context)\n// \t\t\t\tresolve(random.shuffle(rez))\n// \t\t\t}else if(key == \"sample\"){\n// \t\t\t\tvar n = val['n']\n// \t\t\t\t//TODO: Implement -> var w_repl = val['with_replacement'] || false\n// \t\t\t\tvar set = val['set']\n// \t\t\t\tset = await resolveProblemSet(set,context)\n// \t\t\t\tconsole.log(\"IT IS THIS BIG:\", set.length)\n// \t\t\t\tresolve(random.sample(set, n))\n// \t\t\t}else if(key == \"glob\"){\n// \t\t\t\tvar glob_key = val['key']\n// \t\t\t\tvar pattern = val['pattern']\n// \t\t\t\tvar matches = await context.network_layer.glob(pattern,context)\n// \t\t\t\tmatches = matches.map(m => {var o = {}; o[glob_key]=\"/\"+m; return o})\n// \t\t\t\tresolve(matches)\n// \t\t\t}else if(key == \"from_file\"){\n\n// \t\t\t}else{\n// \t\t\t\tresolve(spec)\n// \t\t\t}\n//         }else{\n//         \tresolve([...spec]);\n//         }\n\n// \t})\n// \treturn promise\n// }\n\nfunction serve_next_agent(context, event) {\n  var promise = new Promise(async (resolve, reject) => {\n    var agent_iterator = context.agent_iterator;\n    console.log(\"AGENT ITERATOR\", agent_iterator.length);\n    if (context.agent_iterator.length > 0) {\n      var agent_obj = agent_iterator.shift();\n\n      if (\"repetitions\" in agent_obj) {\n        if (agent_obj[\"repetitions\"] < 0) {\n          agent_iterator.unshift({\n            ...agent_obj,\n            ...{ _rep_count: (agent_obj[\"_rep_count\"] || 1) + 1 }\n          });\n        } else if (agent_obj[\"repetitions\"] == 0) {\n          agent_obj = agent_iterator.shift();\n        } else if (agent_obj[\"repetitions\"] >= 2) {\n          agent_obj[\"repetitions\"] -= 1;\n          agent_iterator.unshift({\n            ...agent_obj,\n            ...{ _rep_count: (agent_obj[\"_rep_count\"] || 1) + 1 }\n          });\n        }\n        agent_obj[\"_rep_count\"] = agent_obj[\"_rep_count\"] || 1;\n      }\n\n      var problem_set = await evalJSONFunc(agent_obj[\"problem_set\"], context);\n      console.log(\"RESOLVED PROBLEM SET\", [...problem_set]);\n      // if(typeof(agent_obj[\"problem_set\"]) == 'object'){\n      // \tvar problem_set = {...agent_obj[\"problem_set\"]};\n      // \tproblem_set = await resolveProblemSet(problem_set)\n      // }else{\n      // \tvar problem_set = [...agent_obj[\"problem_set\"]];\n      // }\n\n      agent_obj = { ...(context.file_params[\"agent\"] || {}), ...agent_obj };\n\n      if (\n        context.file_params[\"agent\"] &&\n        context.file_params[\"agent\"][\"args\"]\n      ) {\n        agent_obj[\"args\"] = {\n          ...context.file_params[\"agent\"][\"args\"],\n          ...agent_obj[\"args\"]\n        };\n      }\n      var agent_params = agent_obj[\"set_params\"] || {};\n      var rep_count_str =\n        agent_obj[\"_rep_count\"] != null\n          ? \"(\" + agent_obj[\"_rep_count\"] + \")\"\n          : \"\";\n      agent_obj[\"agent_name\"] += rep_count_str;\n      var agent_description =\n        \"Agent Name: \" +\n        agent_obj[\"agent_name\"] +\n        \"\\nAgent Type: \" +\n        agent_obj[\"agent_type\"]; //+\"<br>\"\n\n      var prior_knowledge = [...(agent_obj[\"prior_knowledge\"] || [])];\n\n      var outer_loop_controller = null;\n      if (\"outer_loop_controller\" in agent_obj) {\n        outer_loop_controller = parseOuterLoopController(\n          agent_obj[\"outer_loop_controller\"],\n          problem_set\n        );\n        problem_set = [outer_loop_controller];\n      }\n\n      var other_data = { ...agent_obj };\n      delete other_data[\"problem_set\"];\n      delete other_data[\"agent_name\"];\n      delete other_data[\"agent_type\"];\n\n      resolve({\n        updateContext: {\n          start_state_history: [],\n          request_history: [],\n          session_id: CTATGuid.guid(),\n          user_guid: agent_obj[\"agent_name\"], //\"Stu_\" + CTATGuid.guid(),\n\n          agent_params: agent_params,\n          agent_name: agent_obj[\"agent_name\"],\n          agent_type: agent_obj[\"agent_type\"],\n          agent_description: agent_description,\n          other_agent_data: other_data,\n\n          agent_iterator: agent_iterator,\n          problem_set: problem_set,\n          prior_knowledge: prior_knowledge,\n          agent_start_time: new Date()\n        }\n      });\n    } else {\n      resolve(null);\n    }\n  });\n  return promise;\n}\n\nfunction handle_prior_knowledge(context, event) {\n  var promise = new Promise((resolve, reject) => {\n    // console.log(\"WOOP?\")\n    var prior_knowledge = context.prior_knowledge;\n    while (prior_knowledge.length > 0) {\n      console.log(\"CURRENT\", prior_knowledge);\n      var current = prior_knowledge.shift();\n      var out = applyPriorKnowledge(context, current, prior_knowledge);\n      if (out[\"updateContext\"]) {\n        resolve({ updateContext: out[\"updateContext\"] });\n      }\n      if (out[\"train_now\"] || false) {\n        return promise;\n      }\n    }\n\n    resolve({\n      updateContext: {\n        prior_knowledge: prior_knowledge,\n        problem_iterator: context.problem_set\n      }\n    });\n  });\n  return promise;\n}\n\nasync function _next_prob_obj(\n  problem_iterator,\n  agent_params,\n  file_params,\n  context\n) {\n  var promise = new Promise(async (resolve, reject) => {\n    var prob_obj = problem_iterator.shift();\n    while (prob_obj != null && \"outer_loop_controller\" in prob_obj) {\n      var nl = context.network_layer;\n      if (!nl.OUTER_LOOP_URL) {\n        nl.kill_this(\n          \"\\nCANNOT USE 'outer_loop_controller' : {} pattern unless \" +\n            \"running train.py with --outer-loop flag.\\n\"\n        );\n      }\n      // console.log(\"HERE1.5\")\n\n      var controller = prob_obj[\"outer_loop_controller\"];\n      if (!controller[\"initialized\"]) {\n        //TODO: allow for multiple controllers?\n        // console.log(\"HERE1.6\")\n        await nl.newOuterLoopController(controller, context);\n        controller[\"initialized\"] = true;\n        // console.log(\"HERE1.7\")\n      }\n      // console.log(\"HERE1.9\")\n      var next = await nl.nextProblem(controller, context);\n      // console.log(\"HERE2\")\n      if (next != null) {\n        problem_iterator.unshift({ ...prob_obj });\n        prob_obj = next;\n      } else if (problem_iterator.length > 0) {\n        prob_obj = problem_iterator.shift();\n      } else {\n        prob_obj = null;\n      }\n    }\n\n    // console.log(prob_obj);trz\n    if (!prob_obj) {\n      resolve([null, agent_params]);\n      return;\n    }\n\n    while (\"set_params\" in prob_obj) {\n      agent_params = { ...agent_params, ...prob_obj[\"set_params\"] };\n      prob_obj = problem_iterator.shift();\n      if (!prob_obj) {\n        resolve([null, agent_params]);\n        return;\n      }\n    }\n    // console.log(prob_obj)\n    var fp_clone = { ...file_params };\n    delete fp_clone[\"agent\"];\n    prob_obj = { ...fp_clone, ...agent_params, ...prob_obj };\n    // console.log(prob_obj,agent_params)\n    resolve([prob_obj, agent_params]);\n    return;\n  });\n  return promise;\n}\n\nfunction serve_next_problem(context, event) {\n  var promise = new Promise(async (resolve, reject) => {\n    var prob_obj = null;\n    var agent_params = context.agent_params;\n    var file_params = context.file_params;\n    var problem_iterator = context.problem_iterator;\n    var nl = context.network_layer;\n    var interactive = context.interactive;\n    console.log(\"PROBLEM ITERATOR\", problem_iterator.length);\n\n    if (problem_iterator.length > 0) {\n      // console.log(\"HERE1\")\n      [prob_obj, agent_params] = await _next_prob_obj(\n        problem_iterator,\n        agent_params,\n        file_params,\n        context\n      );\n      // console.log(prob_obj,agent_params)\n      // console.log(\"SLOOOP\")\n      // console.log(prob_obj)\n      if (prob_obj) {\n        if (\"repetitions\" in prob_obj) {\n          if (prob_obj[\"repetitions\"] < 0) {\n            problem_iterator.unshift({ ...prob_obj });\n          } else if (prob_obj[\"repetitions\"] == 0) {\n            [prob_obj, agent_params] = await _next_prob_obj(\n              problem_iterator,\n              agent_params,\n              file_params,\n              context\n            );\n          } else if (prob_obj[\"repetitions\"] >= 2) {\n            prob_obj[\"repetitions\"] -= 1;\n            problem_iterator.unshift({ ...prob_obj });\n          }\n        }\n\n        // var EXAMPLES_ONLY = prob_obj[\"examples_only\"] || false;\n\n        var problem_description = Object.keys(prob_obj).reduce((s, key) => {\n          return s + key + \": \" + prob_obj[key] + \"\\n\";\n        }, \"\");\n\n        resolve({\n          updateContext: {\n            agent_params: agent_params,\n            problem_iterator: problem_iterator,\n            prob_obj: prob_obj,\n            problem_description: problem_description\n          }\n        });\n      } else {\n        resolve(null);\n      }\n    } else {\n      resolve(null);\n    }\n  });\n  return promise;\n}\nfunction load_problem(context, event) {\n  return context.tutor.loadProblem(context);\n}\nfunction query_outerloop(context, event) {}\n\nfunction iteratorEmpty(context, event) {\n  return event.data == null;\n}\nfunction AAID(interactions_state_machine) {\n  var boop = (context, event) => {\n    console.log(\"MOOOP\");\n    return {\n      ...interactions_state_machine.context,\n      ...{ agent_id: context.agent_id }\n    };\n  };\n}\n\nfunction sendProblemDone(context, event){\n  context.network_layer.sendProblemDone(context,event)\n}\n\n// function gerp(event){\n// \tconsole.log(\"GERP\")\n// \treturn event.data['agent_id']\n// }\n\nfunction start_training_interaction(context, event) {\n  console.log(\"START TRAINING INTERACTION\");\n  var app = context.app;\n\n  var pass_along_context = {...pick(context, problem_props),\n                            ...pick(context.prob_obj, problem_props)}\n  // {\n  //   agent_id: context.agent_id,\n  //   interactive: context.interactive,\n  //   free_author: context.free_author\n  // };\n\n  var interactions_sm = context.interactions_sm.withContext({\n    ...context.interactions_sm.context,\n    ...pass_along_context\n  });\n  var interactions_service = interpret(interactions_sm);\n  context.app.interactions_service = interactions_service;\n  interactions_service.onTransition(app.onInteractionTransition);\n  interactions_service.start();\n}\n\nfunction allDone(context, event) {\n  var nl = context.network_layer;\n  console.log(\"ITS ALL DONE!\");\n  nl.kill_this(\"\\n TRAINING FINISHED SUCCESSFULLY! \\n\", \"info\");\n  // nl.term_print('\\x1b[0;30;47m' + \"TRAINING FINISHED SUCCESSFULLY!\" + '\\x1b[0m');\n}\n\nconst assignInteractionSM = assign({\n  interactions_sm: (context, event) => {\n    var new_context = {\n      ...{app: context.app},\n      ...pick(context,problem_props),\n      ...pick(context.prob_obj,problem_props),\n      ...event.data\n    };\n    console.log(\"assignInteractionSM\", new_context);\n    var sm = build_interactions_sm(\n      new_context.app,\n      new_context\n    );\n    return sm;\n  }\n});\n\n// function create_agent(context,event){\n// \tvar nl = context.network_layer;\n\n// \treturn nl.create_agent(context,event)\n\n// }\n\nexport function build_training_sm(app, interactions_sm) {\n  // interactions_state_machine,network_layer,training_file,tutor,working_dir\n  var nl = app.network_layer;\n  var context = {\n    //Utils\n    app: app,\n    tutor: app.tutor.current,\n    skill_panel: app.skill_panel.current,\n    buttons: app.buttons.current,\n    network_layer: app.network_layer,\n\n    //Inherited\n    interactive: app.props.interactive,\n    training_file: app.props.training_file,\n    working_dir: app.props.working_dir,\n    interactions_sm: interactions_sm,\n\n    //Dynamic\n    file_params: null,\n    agent_params: null,\n    prob_obj: null,\n    // free_author: null\n  };\n  \n  context = {...problem_props_dict,...context}\n\n\n  const sm = Machine(\n    {\n      context: context,\n      initial: \"Loading_Training_File\",\n      states: {\n        Loading_Training_File: {\n          invoke: {\n            id: \"load_training_file\",\n            src: \"load_training_file\",\n            onDone: {\n              target: \"Serving_Training_Sets\",\n              actions: \"updateContext\"\n            },\n            onError: { target: \"Fail\", actions: \"logError\" }\n          }\n        },\n        Serving_Training_Sets: {\n          invoke: {\n            id: \"serve_next_training_set\",\n            src: \"serve_next_training_set\",\n            onDone: [\n              { target: \"All_Done\", cond: \"iteratorEmpty\" },\n              { target: \"Serving_Agents\", actions: \"updateContext\" }\n            ],\n            onError: { target: \"Fail\", actions: \"logError\" }\n          }\n        },\n        Serving_Agents: {\n          invoke: {\n            id: \"serve_next_agent\",\n            src: \"serve_next_agent\",\n            onDone: [\n              { target: \"Serving_Training_Sets\", cond: \"iteratorEmpty\" },\n              { target: \"Creating_Agent\", actions: \"updateContext\" }\n            ],\n            onError: { target: \"Fail\", actions: \"logError\" }\n          }\n        },\n        Creating_Agent: {\n          invoke: {\n            id: \"create_agent\",\n            src: \"create_agent\",\n            onDone: {\n              target: \"Handling_Prior_Knowledge\",\n              actions: \"assignAgentId\"\n            },\n            onError: { target: \"Fail\", actions: \"logError\" }\n          }\n        },\n        Handling_Prior_Knowledge: {\n          invoke: {\n            id: \"handle_prior_knowledge\",\n            src: \"handle_prior_knowledge\",\n            onDone: { target: \"Serving_Problems\", actions: \"updateContext\" },\n            onError: { target: \"Fail\", actions: \"logError\" }\n          }\n        },\n        Serving_Problems: {\n          invoke: {\n            id: \"serve_next_problem\",\n            src: \"serve_next_problem\",\n            onDone: [\n              { target: \"Serving_Agents\", cond: \"iteratorEmpty\" },\n              { target: \"Waiting_Problem_Load\", actions: \"updateContext\" }\n            ],\n            onError: { target: \"Fail\", actions: \"logError\" }\n          }\n        },\n        Waiting_Problem_Load: {\n          invoke: {\n            id: \"load_problem\",\n            src: \"load_problem\",\n            onDone: { target: \"Training\", actions: \"updateContext\" },\n            onError: { target: \"Fail\", actions: \"logError\" }\n          }\n        },\n        Training: {\n          entry: \"start_training_interaction\",\n          on: {\n            PROBLEM_DONE: {\n              target : \"Serving_Problems\",\n              actions : \"sendProblemDone\",\n            },\n            CHANGE_INTERACTION_MODE: {\n              target: \"Serving_Problems\",\n              actions: \"assignInteractionSM\"\n            }\n          }\n          // invoke : {\n          // \tid: \"interactions_state_machine\",\n          // \tsrc: \"interactions_state_machine\",\n          // \tdata : (context, event) => ({...interactions_state_machine.context, ...{\"agent_id\": context.agent_id}}),\n          // \tonDone: \"Serving_Problems\",\n          // \tonError: {target :'Fail', actions : \"logError\"}\n          // },\n          // entry : send({type: \"ASSIGN_AGENT\", \"agent_id\" : agent_id})\n        },\n        All_Done: {\n          entry: \"allDone\",\n          type: \"final\"\n        },\n        Fail: {\n          entry: [\"logError\", \"kill_this\"]\n        }\n      }\n    },\n    {\n      services: {\n        load_training_file: load_training_file,\n        serve_next_training_set: serve_next_training_set,\n        serve_next_agent: serve_next_agent,\n        create_agent: nl.createAgent,\n        serve_next_problem: serve_next_problem,\n        load_problem: load_problem,\n        handle_prior_knowledge: handle_prior_knowledge\n\n        // interactions_state_machine : interactions_state_machine,\n      },\n      actions: {\n        start_training_interaction: start_training_interaction,\n        logError: (context, event) => {\n          console.error(event.data);\n        },\n        updateContext: assign((context, event) => {\n          return event.data.updateContext;\n        }),\n        assignAgentId: assign((context, event) => {\n          return { agent_id: event.data[\"agent_id\"] };\n        }),\n        allDone: allDone,\n        assignInteractionSM: assignInteractionSM,\n        sendProblemDone : sendProblemDone\n      },\n      guards: {\n        iteratorEmpty: iteratorEmpty\n      }\n    }\n  );\n\n  // console.log(\"JSON MACHINE\",sm)\n  return sm;\n}\n","import path from 'path'\n\nconst type_map = {\n\t\"bestintersect\" : applyBestInstersect\n}\n\n\nexport function applyPriorKnowledge(context,spec,iter){\n\tvar type = spec.type.toLowerCase().replace(\"_\", \"\")\n\treturn type_map[type](spec,iter)\n\n}\n\n\nfunction buildTransactionCache(){\n\n}\n\nfunction assertTransactionCache(){\n\n}\n\nasync function applyBestInstersect(context,spec,pk_iter){\n\t// var promise = new Promise((resolve, reject) => {\n\tvar cache_folder = spec[\"cache_folder\"] || (context.working_dir + \"/\" + \".pkcache\")\n\tvar cache = cache_folder + \"/\" + path.basename(context.training_file) + \".cache\"\n\tconsole.log(\"MOOOOOOOOO\", cache)\n\tvar cache_content = await fetch(cache)\n\t \t.then(function(response) {\n\t \t\tif (!response.ok) {\n\t            throw Error(response.statusText);\n\t        }\n\t        return response\n\t \t})\n\t\t.then((response) => response.text())\n\t\t.catch((error) => {return null})\n\n\tvar out\n\tif(cache_content == null || (false && \"should also check md5sum of agentobj &&\")) {\n\t\t//No Cached Data -- Building by sampling from problems \n\t\tout = { updateContext : \n\t\t\t\t{\n\t\t\t\t\tprior_knowledge : [spec] + pk_iter,\n\t\t\t\t\tproblem_iterator : [] //?\n\t\t\t\t},\n\t\t\t\ttrain_now : true\n\t\t\t  }\n\t}else{\n\t\t//Cached Data Exists -- Training by \n\t\tout = { updateContext : \n\t\t\t\t{\n\t\t\t\t\tprior_knowledge : pk_iter,\n\t\t\t\t\tproblem_iterator : [] //?\n\t\t\t\t},\n\t\t\t\ttrain_now : true\n\t\t\t  }\n\t}\n\n\treturn out\n\n\n\t// }\n\n}","import {Random} from \"random-js\"\nimport papa from \"papaparse\"\nimport path from \"path\"\nconst random = new Random()\n\n\nexport var registedFunctions = {\n\t\"concatenate\" : concatenate,\n\t\"shuffle\" : shuffle,\n\t\"sample\" : sample,\n\t\"glob\" : glob,\n\t\"from_file\" : from_file,\n\t\"estimate_Pik\" : estimate_Pik,\n\t\"gen_pretraining\" : gen_pretraining,\n\t'gen_pivot_table' : gen_pivot_table,\n\t'mirror_students' : mirror_students\n}\n\nfunction abs_path(p,context){\n\tif(p[0] != \"/\"){\n\t\tp = context.working_dir + \"/\" + p\n\t}\n\treturn p\n}\n\nasync function concatenate(args, context){\n\tvar all = []\n\tfor(var g of args){\n\t\tvar rez = await evalJSONFunc(g,context)\n\t\tall = all.concat(rez)\n\t}\n\treturn all\n}\n\nasync function shuffle(args,context){\n\tvar rez = await evalJSONFunc(args,context)\n\treturn random.shuffle(rez)\n}\n\nasync function sample(args,context){\n\tvar n = args['n']\n\t//TODO: Implement -> var w_repl = val['with_replacement'] || false\n\tvar set = args['set']\n\tset = await evalJSONFunc(set,context)\n\tconsole.log(\"IT IS THIS BIG:\", set.length)\n\treturn random.sample(set, n)\n}\n\nasync function glob(args,context){\n\tif(typeof(args) == 'string'){\n\t\targs = {'pattern' : args}\n\t}\n\tvar glob_key = args['key'] || null\n\tvar pattern = args['pattern']\n\tvar matches = await context.network_layer.glob(pattern,context)\n\tif(glob_key){\n\t\tmatches = matches.map(m => {var o = {}; o[glob_key]=\"/\"+m; return o})\t\n\t}else{\n\t\tmatches = matches.map(m => \"/\"+m)\n\t}\n\treturn matches\n}\n\nasync function from_file(args,context){\n\tthrow \"Not Implemented\"\n}\n\n\n//------------------PRIOR KNOWLEDGE STUFF------------------------\n\nasync function backcast(args,context){\n\n}\n\nfunction p_parse_csv(csv,config={},pre_fetch=false){\n\tvar promise = new Promise(async function(resolve, reject) {\n\t\tconfig['complete'] = resolve\n\t\tif(pre_fetch){\n\t\t\tcsv = await fetch(csv).then(resp => resp.text())\n\t\t}\n\t\tpapa.parse(csv, config)\n\t})\n\treturn promise\n}\n\n\nasync function read_afm_table(file){\n\t// var promise = new Promise(async function(resolve, reject) {\n\tvar config = {\n\t\tdelimiter: \"\\t\",\n\t\theader: true,\n\t\tdynamicTyping: true\n\t}\n\tvar promise = fetch(file)\n\t.then(resp => resp.text())\n\t.then((text) => {\n\t\tvar split = text.split(/\\n{2,}/g);\n\t\tvar kc_table = split[0].split(/Values for .* model.*\\n/)[1]\n\t\tvar student_table = split[1].split(\"in the selected KC model.\\n\")[1]\n\t\t// console.log(\"split\")\n\t\t// console.log(split)\n\t\t// console.log(kc_table)\n\t\t// console.log(student_table)\n\t\treturn [kc_table,student_table]\n\t})\n\t.then(async ([kc_table,stu_table]) => {\n\t\tvar kc_json = await p_parse_csv(kc_table, config)\n\t\tvar stu_json = await p_parse_csv(stu_table, config)\n\t\treturn [kc_json,stu_json]\n\t})\n    return promise\n}\n\nasync function exact_align(args,context){\n\tvar fo_err_by_kc\n\tif(args['fo_err_by_kc'] == null){\n\t\t// console.log(\"afm_stats\")\n\t\tvar [kc_json,stu_json] = await read_afm_table(abs_path(args['afm_stats'],context))\n\t\t// console.log(stu_json)\n\t\tvar stu_intr = stu_json.data.filter((x)=> x[\"Anon Student Id\"] == args['student_id'])[0][\"Intercept\"]\n\n\t\tfo_err_by_kc = {}\n\t\tfor(var row of kc_json.data){\n\t\t\tvar prob = 1.0/(1.0+Math.exp((stu_intr + row['Intercept (logit)'])))\n\t\t\tfo_err_by_kc[row['KC Name']] = prob\n\t\t}\n\t\t// console.log(fo_err_by_kc)\n\t}\n\tfo_err_by_kc = fo_err_by_kc || args['fo_err_by_kc']\n\n\tvar table_path = abs_path(args['error_table'],context)\n\t// console.log(\"table_path\")\n\t// console.log(table_path)\n\tvar error_table = await p_parse_csv(table_path, { delimiter: \"\\t\",header: true, dynamicTyping: true},true)\n\tconsole.log(\"error_table\")\n\tconsole.log(error_table)\n\tvar curve_by_kc = {}\n\t for (var r of error_table.data){\n\t\tvar key = r[\"KC Name\"]\n\t\tif(key){\n\t\t\tdelete r[\"KC Name\"]\n\t\t\tcurve_by_kc[key] = Object.values(r)\n\t\t}\n\t}\n\tconsole.log(\"curve_by_kc\")\n\tconsole.log(curve_by_kc)\n\tvar opps_by_kc = {}\n\tfor(var kc in curve_by_kc){\n\t\tvar curve = curve_by_kc[kc]\n\t\tvar min = Infinity;\n\t\tvar minIndex;\n\t\tvar y = fo_err_by_kc[kc]\n\n\t\t//Always round up\n\t\tfor(const [i,x] of curve.entries()){\n\t\t\tvar diff = y-x\n\t\t\tif(diff < min && diff > 0){\n\t\t\t\tmin = diff\n\t\t\t\tminIndex = i\n\t\t\t}\n\t\t}\n\t\topps_by_kc[kc] = minIndex\n\t}\n\n\t// console.log(\"opps_by_kc\")\n\t// console.log(opps_by_kc)\n\treturn opps_by_kc\n\t\n}\n\nasync function estimate_Pik(args,context){\n\tconsole.log(\"ESTIMATE_PIK\")\n\tvar out;\n\tif(args['method'] == \"exact_align\"){\n\t\tout = await exact_align(args,context)\n\t}else if(args['method'] == \"backcast\"){\n\t\tout = await backcast(args,context)\n\t}\n\tconsole.log(args['KCs'])\n\tconsole.log(\"BEFORE\")\n\tconsole.log({...out})\n\tif('KCs' in args && args['KCs'] != null){\n\t\tvar new_out = {}\n\t\tfor (var key of args['KCs']) {\n\t\t\tnew_out[key] = out[key]\n\t\t}\n\t\tout = new_out\n\t}\n\tconsole.log(\"AFTER\")\n\tconsole.log({...out})\n\tif('max' in args && args['max'] != null){\n\t\tfor (var key in out) {\n\t\t\tout[key] = Math.min(out[key],args['max']);\n\t\t}\n\t}\n\n\treturn out\n}\n\nasync function gen_pretraining(args,context,shuffle=false){\n\t//Get the number of opportunities for each KC\n\tvar opps_by_kc = await evalJSONFunc(args['opportunities'],context)\n\tvar only_attr = args['by_step_id'] || false ? \"step_id\" : \"Selection\" \n\tvar only_str = \"only_\" + only_attr + \"s\"\n\tconsole.log(\"opps_by_kc\")\n\tconsole.log(opps_by_kc)\n\topps_by_kc = {...opps_by_kc}\n\n\t\n\tvar pivot_table\n\tif(typeof(args['step_pivot_table']) == \"string\"){\n\t\talert(\"NOT IMPLEMENTED\")\n\t\t// pivot_table = await p_parse_csv(abs_path(args['step_pivot_table'],context),\n\t\t// { delimiter: \"\\t\",header: true, dynamicTyping: true},true)\t\n\t}else{\n\t\tpivot_table = await evalJSONFunc(args['step_pivot_table'],context)\n\t}\n\t\n\t\n\tconsole.log(\"pivot_table\")\n\tconsole.log(pivot_table)\n\n\tvar problem_pool = Object.keys(pivot_table)\n\tif(shuffle){problem_pool = random.shuffle(problem_pool)}\n\tvar out = []\n\n\tconsole.log(\"problem_pool\")\n\tconsole.log(problem_pool)\n\t\n\t//Not really a core feature, just necessary for this tutor\n\tvar onlys_map = args['onlys_map'] || null\n\n\t//For all problems add to problem set if any kc needs more practice. \n\t//\t If not all KCs need practice only train KCs that need practice.\n\tfor(var p of problem_pool){\n\t\tvar all=true\n\t\tvar any=false\n\t\tvar only_steps = []\n\t\tvar prob = pivot_table[p]\n\t\tfor(var kc in prob){\n\t\t\tif(opps_by_kc[kc] > 0){\n\t\t\t\topps_by_kc[kc] -= 1\n\t\t\t\tvar steps = prob[kc][only_attr]\n\t\t\t\tsteps = Array.from(steps)\n\t\t\t\tif(onlys_map){\n\t\t\t\t\tsteps = steps.map(x => onlys_map[x])\n\t\t\t\t}\n\t\t\t\tif(steps.length==1){steps = steps[0]}\n\t\t\t\tonly_steps.push(steps)\n\t\t\t\tany=true\n\t\t\t}else{\n\t\t\t\tall=false\n\t\t\t}\n\t\t}\n\n\t\t\n\t\tif(any){\n\t\t\tvar o = {}\n\t\t\to[args['problem_key']] = p\n\t\t\tif(!all){o[only_str] = only_steps}\n\t\t\tout.push(o)\n\t\t}\n\t}\n\n\t//Throw an error if there weren't enough problems\n\tif(Object.values(opps_by_kc).reduce((a,b) => a + b, 0) > 0){\n\t\tvar error = \"Insufficient problems in problem_pool to pretrain requested number of steps. \" + \n\t\t\t\"Additional problems required for KCs/Steps: \" + JSON.stringify(opps_by_kc)\n\t\tcontext.network_layer.kill_this(error)\n\t\tconsole.error(error)\n\t}\n\n\tconsole.log(\"gen_pretraining\")\n\tconsole.log(out)\n\n\tconsole.log(\"opps_by_kc\")\n\tconsole.log(opps_by_kc)\n\treturn out\n}\n\nasync function mirror_students(args,context){\n\tconsole.log(\"MIRROR_START\")\n\tvar human_transactions = abs_path(args['human_transactions'],context)\n\t\n\tvar human_afm_stats = args['human_afm_stats']\n\tvar pool_agent_error_table = args['pool_agent_error_table']\n\tvar Pik_method = args['Pik_method']\n\tvar problem_key = args['problem_key']\n\tvar kc_model = args['kc_model']\n\tvar KCs = args['KCs']\n\tvar maximum = args['max']\n\tvar human_problems = await evalJSONFunc(args['human_problems'],context)\n\tvar human_path_map = {}\n\tfor(var p of human_problems){\n\t\thuman_path_map[path.basename(p).split(\".\")[0]] = p\n\t}\t\n\n\tif('step_pivot_table' in args){\n\t\tvar step_pivot_table = await evalJSONFunc(args['step_pivot_table'],context)\n\t}else{\n\t\tvar pool_agent_problems = await evalJSONFunc(args['pool_agent_problems'],context)\n\t\tvar step_pivot_table = {\"gen_pivot_table\" : {\n\t\t\t\"transaction_file\" : args['pool_agent_transactions'],\n          \t\"problem_pool\" : pool_agent_problems,\n          \t\"kc_model\" : args['kc_model']\n\t\t  }\n\t\t}\n\t\tstep_pivot_table = await evalJSONFunc(step_pivot_table,context)\n\t}\n\n\t\n\n\t\n\n\t\n\tvar human_prob_seq = {}\n\t// var buggy_students = new Set()\n\tvar config = {\n\t\tdynamicTyping: true,\n\t\tdelimiter: \"\\t\",\n\t\theader : true,\n\t\tdownload : true,\n\t\tstep : function (row){\n\t\t\tvar row = row.data\n\t\t\tif(row && 'Anon Student Id' in row){\n\t\t\t\tvar sequence = human_prob_seq[row['Anon Student Id']] || []\n\t\t\t\tvar prob = row['Problem Name'] || \"\"\n\t\t\t\tvar view = row['Problem View'] || \"\"\n\t\t\t\tif(prob != \"\"){\n\t\t\t\t\tvar pv = String(prob) + \"#\"+ String(view)\n\t\t\t\t\tif(sequence.length == 0){\n\t\t\t\t\t\tsequence = [pv]\n\t\t\t\t\t}else if(!sequence.includes(pv)){\n\t\t\t\t\t\t// if(sequence.includes(pv)){\n\t\t\t\t\t\t// \tconsole.log(\"BUGGY\")\n\t\t\t\t\t\t// \tconsole.log(pv,[...sequence])\n\t\t\t\t\t\t// \t// buggy_students.add(row['Anon Student Id'])\n\t\t\t\t\t\t// }\n\t\t\t\t\t\tsequence.push(pv)\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\thuman_prob_seq[row['Anon Student Id']] = sequence\n\t\t\t}\n\t\t}\n\t}\n\n\n\t//Run the 'step' function specified above line by line-by-line to find the problem sequences.\n\tvar url = context.network_layer.HOST_URL + human_transactions\n\tconsole.log(\"human transactions\")\n\tconsole.log(url)\n\tvar nothing = await p_parse_csv(url,config,false)\n\n\t// console.log(\"CRAFF\")\n\t// console.log(human_prob_seq)\n\t// console.log(buggy_students)\n\t// for(var std of buggy_students){\n\t// \tvar text = \"Will Skip Student \" + std + \". Multiple problems done concurrently.\"\n\t// \tconsole.warn(text)\n\t// \tcontext.network_layer.term_print(text,'warning')\n\t// \tdelete human_prob_seq[std]\n\t// }\n\tconsole.log(\"BEEE\")\n\tconsole.log(human_prob_seq)\n\t//Strip out view numbers\n\tfor(var std in human_prob_seq){\n\t\thuman_prob_seq[std] = human_prob_seq[std].map(x => x.substring(0, x.lastIndexOf(\"#\")))\n\t}\n\tconsole.log(\"AFFFF\")\n\tconsole.log(human_prob_seq)\n\n\n\tconsole.log(\"human_prob_seq\")\n\tconsole.log(human_prob_seq)\n\n\t// Turn the problem names from the student transactions into paths\n\tfor(var student in human_prob_seq){\n\t\tvar seq = human_prob_seq[student]\n\t\tvar new_seq = []\n\t\tfor(var prob of seq){\n\t\t\tvar full_path = human_path_map[prob]\n\t\t\tif(full_path){\n\t\t\t\tvar o = {}\n\t\t\t\to[problem_key] = full_path\n\t\t\t\tnew_seq.push(o)\n\t\t\t}\n\t\t}\n\t\thuman_prob_seq[student] = new_seq\n\t}\n\n\tvar out = []\n\tif('store_opp_table' in args){\n\t\tvar opp_table = []\n\t}\n\n\tconsole.log(\"full_paths\")\n\tconsole.log(human_prob_seq)\n\tfor(var student_id in human_prob_seq){\n\t\tvar stu_seq = human_prob_seq[student_id]\n\t\tif(stu_seq.length > 0){\n\t\t\tvar opps_by_kc = {\"estimate_Pik\" :{\n\t\t              \"method\" : Pik_method,\n\t\t              \"afm_stats\" : human_afm_stats,\n\t\t              \"student_id\" : student_id,\n\t\t              \"error_table\" : pool_agent_error_table,\n\t\t              \"KCs\" : KCs,\n\t\t              \"max\" : maximum,\n\t\t              }\n\t\t            }\n\t\t    opps_by_kc = await evalJSONFunc(opps_by_kc,context)\n\n\t\t    //Just for debugging\n\t\t    if('store_opp_table' in args){\n\t\t    \tvar o = {}\n\t\t    \to['Anon Student Id'] = student_id\n\t\t    \tfor(var kc in opps_by_kc){\n\t\t    \t\to[kc] = opps_by_kc[kc]\n\t\t    \t}\n\t\t    \topp_table.push(o)\n\t\t    }\n\n\t\t\tvar pretraining = {\"gen_pretraining\" : \n\t\t\t\t{\"opportunities\" : opps_by_kc,\n\t\t\t\t\t// {\"estimate_Pik\" :{\n\t\t   //            \"method\" : Pik_method,\n\t\t   //            \"afm_stats\" : human_afm_stats,\n\t\t   //            \"student_id\" : student_id,\n\t\t   //            \"error_table\" : pool_agent_error_table,\n\t\t   //            \"KCs\" : KCs,\n\t\t   //            \"max\" : maximum,\n\t\t   //            }\n\t\t   //          },\n\t            \"step_pivot_table\" : step_pivot_table,\n\t            \"problem_key\" : problem_key,\n\t            \"kc_model\" : kc_model,\n\t            \"onlys_map\" : args[\"onlys_map\"] || null\n\t\t        }\n\t\t\t}\n\t\t\tpretraining = await evalJSONFunc(pretraining,context)\n\n\t\t\tvar d1 = {\"set_params\": {\n\t\t\t\t\"domain_name\" : 'prior_knowledge'\n\t\t\t}}\n\t\t\tvar d2 = {\"set_params\": {\n\t\t\t\t\"domain_name\" : undefined\n\t\t\t}}\n\t\t\n\t\t\tvar cat_list = [d1,pretraining,d2,stu_seq]\n\n\t\t\tvar agent_obj = {\n\t\t\t\t\"agent_name\" : student_id,\n\t\t\t\t\"problem_set\" : {\"concatenate\" : cat_list}\n\t\t\t}\n\t\t\tout.push(agent_obj)\t\n\t\t}else{\n\t\t\tvar text = \"Will Skip Student \" + student_id + \"because did not do any problems.\"\n\t\t\tconsole.warn(text)\n\t\t\tcontext.network_layer.term_print(text,'warning')\n\t\t}\n\t\t\n\t}\n\n\tif('store_opp_table' in args){\n\t\tvar csv = papa.unparse(opp_table,{delimiter: \"\\t\"})\n\t\tconsole.log(\"OUT CSV\")\n\t\tconsole.log(csv)\n\t}\n\tconsole.log(\"out\")\n\tconsole.log(out)\n\n\treturn out\n\n\n\n\n\n}\n\nasync function gen_pivot_table(args,context){\n\tvar pivot_table\n\n\t//If cache location speficied just read from the cache\n\tif(\"cache\" in args){\n\t\tvar pivot_table_csv = await p_parse_csv(abs_path(args['cache'],context))\n\t\tpivot_table = {}\n\t\tfor(var row of pivot_table_csv){\n\t\t\tpivot_table[row['Problem Path']] = pivot_table[row['Problem Path']] || {}\n\t\t\tpivot_table[row['Problem Path']][row['KC']][\"step_id\"] = row['step_id'].split(\",\")\n\t\t\tpivot_table[row['Problem Path']][row['KC']][\"Selection\"] = row['Selection'].split(\",\")\n\t\t}\n\t}\n\tif(pivot_table == null){\n\t\tvar transaction_file = abs_path(args['transaction_file'],context)\n\t\tvar problem_pool = await evalJSONFunc(args['problem_pool'],context)\n\t\tvar path_map = {}\n\t\tfor(var p of problem_pool){\n\t\t\tpath_map[path.basename(p).split(\".\")[0]] = p\n\t\t}\n\t\t\n\t\t//Get the column in the transaction file for the specified KC model.\n\t\tvar kc_model_id = args['kc_model'] || null\n\t\tkc_model_id = kc_model_id != null ? 'KC ('+kc_model_id+')' : \"Step Name\" \n\t\t\n\t\t//Read the transaction file on line at a time\n\t\tpivot_table = {}\n\t\tvar config = {\n\t\t\tdynamicTyping: true,\n\t\t\tdelimiter: \"\\t\",\n\t\t\theader : true,\n\t\t\tdownload : true,\n\t\t\tstep : function (row){\n\t\t\t\trow = row.data\n\n\t\t\t\t//Only record CORRECT steps (because others could be out of graph)\n\t\t\t\tif(row['Outcome'] === \"CORRECT\"){\n\t\t\t\t\tvar p = path_map[row['Problem Name']] || null\n\t\t\t\t\tif(p != null){\n\n\t\t\t\t\t\t//Fill the pivot table Problem Path, KC, Step id\n\t\t\t\t\t\tif(!(p in pivot_table)){\n\t\t\t\t\t\t\tpivot_table[p] = {}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar kc_str = row[kc_model_id]\n\t\t\t\t\t\tif(kc_str){\n\t\t\t\t\t\t\tif(!(kc_str in pivot_table[p])){\n\t\t\t\t\t\t\t\tpivot_table[p][kc_str] = {\"step_id\": new Set(), \"Selection\": new Set()}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar step_id_set = pivot_table[p][kc_str]\n\t\t\t\t\t\t\tstep_id_set['step_id'].add(row['CF (step_id)'])\n\t\t\t\t\t\t\tstep_id_set['Selection'].add(row['Selection'])\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//Run the 'step' function specified above line by line-by-line to make the table.\n\t\tvar url = context.network_layer.HOST_URL + transaction_file\n\t\tvar nothing = await p_parse_csv(url,config,false)\n\n\t\t//If cache location specified cache the pivot table\n\t\tif(\"cache\" in args){\n\t\t\tvar csv = []\n\t\t\tfor(var prob in pivot_table){\n\t\t\t\tvar kc_table = pivot_table[prob]\n\t\t\t\tfor(var kc in kc_table){\n\t\t\t\t\tcsv.append({\"Problem Path\" : prob, \"KC\" : kc,\n\t\t\t\t\t\t \"step_id\": kc_table[kc]['step_id'].join(\",\"),\n\t\t\t\t\t\t \"Selection\": kc_table[kc]['Selection'].join(\",\")})\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tvar csv_str = papa.unparse(csv,{delimiter: \"\\t\", header:true, 'newline':'\\n'})\n\t\t\tcontext.network_layer.write_file(abs_path(args['cache'],context), csv_str)\n\t\t}\n\t\treturn pivot_table\n\t}\n}\n\nexport async function evalString(){\n\tthrow \"Not Implemented\"\n}\n\nexport async function evalJSONFunc(spec, context){\n\tif(Array.isArray(spec)){\n\t\treturn [...spec]\n\t}else if(typeof(spec) === 'object'){\n\t\tspec = {...spec};\n\n\t\tvar key = Object.keys(spec)[0];\n\t\tvar val = spec[key]\n\t\tif(key in registedFunctions){\n\t\t\treturn await registedFunctions[key](val,context)\n\t\t}else{\t\n\t\t\treturn spec\n\t\t}\n\t}else{\n\t\treturn spec\n\t}\n}\n\n// export async function evalFunc(name,args,context){\n// \tif(name in registedFunctions){\n// \t\treturn await registedFunctions[name](args,context)\n// \t}else{\t\n// \t\tthrow \"Function \" + name + \" is not a registed function.\"\n// \t}\n// }","import autobind from \"class-autobind\";\nconst AL_RETRY_LIMIT = 3;\nconst TIMEOUT = 100;\n\n// var $ = require('jquery');\n\n// var fetch = require(\"node-fetch\");\n\nfunction sleep(time) {\n  return new Promise(resolve => setTimeout(resolve, time));\n}\n\nfunction ignoreKeys(key, value) {\n  if (key == \"matches\") return undefined;\n  else return value;\n}\n\nasync function wait(ms) {\n  return new Promise(resolve => {\n    setTimeout(resolve, ms);\n  });\n}\n\n//https://dev.to/ycmjason/javascript-fetch-retry-upon-failure-3p6g\nconst fetch_retry = async (\n  url,\n  options,\n  n = AL_RETRY_LIMIT,\n  t = TIMEOUT,\n  exp = true\n) => {\n  for (let i = 0; i < n; i++) {\n    try {\n      return await fetch(url, options);\n    } catch (err) {\n      console.log(\"AL ERROR Retrying\", err);\n      const isLastAttempt = i + 1 === n;\n      if (isLastAttempt) throw err;\n      console.log(\"waiting\", exp ? t * Math.pow(2, i) : t);\n      await wait(exp ? t * Math.pow(2, i) : t);\n    }\n  }\n};\n\nconst JSON_HEADERS = {\n  Accept: \"application/json\",\n  \"Content-Type\": \"application/json\"\n};\n\nexport default class NetworkLayer {\n  constructor(AL_URL, HOST_URL, OUTER_LOOP_URL) {\n    this.AL_URL = AL_URL;\n    this.HOST_URL = HOST_URL;\n    this.OUTER_LOOP_URL = OUTER_LOOP_URL;\n    this.request_history = [];\n    autobind(this);\n    // this.createAgent = this.createAgent.bind(this)\n    // this.sendFeedback = this.sendFeedback.bind(this)\n    // this.sendTrainingData = this.sendTrainingData.bind(this)\n    // this.queryApprentice = this.queryApprentice.bind(this)\n    // this.term_print = this.term_print.bind(this)\n    // this.kill_this = this.kill_this.bind(this)\n  }\n\n  createAgent(context, event) {\n    var data = {\n      name: context.agent_name,\n      agent_type: context.agent_type,\n      project_id: context.project_id\n    };\n    data = { ...context.other_agent_data, ...data };\n\n    console.log(this.AL_URL + \"/create/\");\n\n    this.request_history = [];\n    return fetch_retry(\n      this.AL_URL + \"/create/\",\n      { method: \"POST\", headers: JSON_HEADERS, body: JSON.stringify(data) },\n      6\n    ).then(res => res.json());\n  }\n\n  sendFeedback(context, event) {\n    console.log(\"sendFeedback\");\n    if (context.staged_SAI === null) {\n      console.error(\"cannot give feedback on no action.\");\n    }\n\n    const skill_applications = context.skill_applications;\n    const feedback_map = context.feedback_map;\n\n    var out;\n    if (feedback_map && Object.keys(feedback_map).length > 0) {\n      // var skill_applications_subset = []\n      // var rewards = []\n      var d_list = [];\n      for (var index in feedback_map) {\n        var skill_app = skill_applications[index];\n        // skill_applications_subset.push({\n        var data = {\n          state: context.state,\n          rhs_id: skill_app[\"rhs_id\"],\n          mapping: skill_app[\"mapping\"],\n          reward: feedback_map[index].toLowerCase() == \"correct\" ? 1 : -1\n        };\n        if (context.interactive) {\n          data[\"add_skill_info\"] = true;\n        }\n        d_list.push(data);\n        // if(out){\n        // \tout = out.then((resp)=>this.sendTrainingData(data,context.agent_id))\n        // \t\t .then(()=>sleep(10))\n        // }else{\n        // \tout = this.sendTrainingData(data,context.agent_id)\n        // }\n      }\n      out = this.sendTrainingData(d_list, context.agent_id);\n\n      // if(data.reward == null && context.reward != null){\n      // \tdata.reward = context.reward\n      // }\n    } else {\n      var skill_app = context.staged_SAI;\n      var data = {\n        state: context.state,\n        selection: skill_app[\"selection\"],\n        action: skill_app[\"action\"],\n        inputs: skill_app[\"inputs\"],\n        foci_of_attention: skill_app[\"foci_of_attention\"],\n        rhs_id: skill_app[\"rhs_id\"],\n        mapping: skill_app[\"mapping\"],\n        reward: skill_app[\"reward\"]\n      };\n      if (context.interactive) {\n        data[\"add_skill_info\"] = true;\n      }\n      out = this.sendTrainingData(data, context.agent_id);\n    }\n\n    return out;\n  }\n\n\n  sendTrainingData(data, agent_id) {\n    console.log(\"sendTrainingData\");\n    // console.log(\"SAI: \", sai_data)\n\n    // loggingLibrary.logResponse (transactionID,\"textinput1\",\"UpdateTextField\",\"Hello World\",\"RESULT\",\"CORRECT\",\"You got it!\");\n    // console.log(sai_data)\n    const URL = this.AL_URL + \"/train/\" + agent_id + \"/\";\n    return fetch_retry(URL, {\n      method: \"POST\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(data, ignoreKeys)\n    })\n      .then(response => response.text())\n      .then(text => {\n        try {\n          const data = JSON.parse(text);\n          return data;\n          // Do your JSON handling here\n        } catch (err) {\n          return {};\n          // It is text, do you text handling here\n        }\n      });\n\n\n  }\n\n  queryApprentice(context, event) {\n    console.log(\"queryApprentice\");\n\n    var data = {\n      state: context.state\n    };\n    if (context.interactive) {\n      data[\"kwargs\"] = { add_skill_info: true, n: 0 };\n    }\n\n    this.request_history.push(data);\n\n    const URL = this.AL_URL + \"/request/\" + context.agent_id + \"/\";\n\n    return fetch_retry(URL, {\n      method: \"POST\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(data)\n    }).then(res => res.json());\n  }\n\n  checkApprentice(context, event) {\n    console.log(\"checkApprentice\");\n\n    var data = {\n      state: context.state,\n      ...context.staged_SAI\n    };\n\n    const URL = this.AL_URL + \"/check/\" + context.agent_id + \"/\";\n\n    return fetch_retry(URL, {\n      method: \"POST\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(data)\n    })\n      .then(res => res.json())\n      .then(json => +json[\"reward\"]);\n  }\n\n  term_print(message, type = \"default\") {\n    var data = { message: message, type: type };\n    return fetch_retry(this.HOST_URL, {\n      method: \"PRINT\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(data)\n    });\n  }\n\n  kill_this(message, type = \"error\") {\n    var data = { message: message, type: type };\n    return fetch_retry(this.HOST_URL, {\n      method: \"QUIT\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(data)\n    });\n  }\n\n  write_file(file, data) {\n    var data = {\n      file: file,\n      data: data\n    };\n    return fetch_retry(this.HOST_URL, {\n      method: \"WRITE\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(data)\n    });\n  }\n\n  sendProblemDone(context,event){\n    //NOT YET IMPLEMENTED -- Might not need to\n    var data = {}\n    return fetch_retry(this.HOST_URL, {\n      method: \"PROBLEM_DONE\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(data, ignoreKeys)\n    })\n  }\n\n  generate_nools(context, event) {\n    const URL = this.AL_URL + \"/get_skills/\" + context.agent_id + \"/\";\n    var data = { states: this.request_history.map(x => x[\"state\"]) };\n    return fetch_retry(URL, {\n      method: \"POST\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(data, ignoreKeys)\n    })\n      .then(res => res.json())\n      .then(json => {\n        console.log(\"NOOLS DIR: \", context.nools_dir);\n        var out_data = {\n          nools_dir: context.nools_dir,\n          problems: context.start_state_history,\n          skills: json\n        };\n        return fetch(this.HOST_URL, {\n          method: \"GEN_NOOLS\",\n          headers: JSON_HEADERS,\n          body: JSON.stringify(out_data, ignoreKeys)\n        });\n      });\n  }\n\n  \n\n  generateBehaviorProfile(context, event = {}) {\n    // data = {'states':request_history.map(x => x['state'])}\n    // console.log(JSON.stringify(data))\n\n    // requests = request_history\n    event.data = event.data || {};\n    var requests = event.data.requests || this.request_history;\n    var dir = event.data.out_dir || (context.working_dir || \".\") + \"/bprofiles\";\n    var HOST_URL = this.HOST_URL;\n    var AL_URL = this.AL_URL;\n    // requests = ground_truth_requests\n\n    // console.log(nools_dir)\n    var now = new Date();\n    var elapse =\n      (((now - context.agent_start_time) % 86400000) % 3600000) / 60000;\n    var start_data = { dir: dir, elapse_minutes: elapse.toFixed(1) };\n\n    var promise = fetch(HOST_URL, {\n      method: \"START_BEHAVIOR_PROFILE\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(start_data)\n    }).then(async function(whatever) {\n      for (let item of requests) {\n        // requests.forEach(function (item, index) {\n        var s = item[\"state\"];\n        var data = {\n          state: s,\n          kwargs: { add_skill_info: true, n: -1 }\n        };\n        var resp = await fetch_retry(\n          AL_URL + \"/request/\" + context.agent_id + \"/\",\n          {\n            method: \"POST\",\n            headers: JSON_HEADERS,\n            body: JSON.stringify(data)\n          }\n        ).then(res => res.json());\n\n        var responses = [];\n        if (\"responses\" in resp) {\n          resp[\"responses\"].forEach(function(r, index) {\n            var sai = {\n              selection: r[\"selection\"],\n              action: r[\"action\"],\n              inputs: r[\"inputs\"]\n            };\n            console.log(r);\n            console.log(r[\"selection\"]);\n            responses.push(sai);\n          });\n        }\n        var completeness_data = {\n          state: s,\n          responses: responses,\n          dir: dir\n        };\n        await fetch(HOST_URL, {\n          method: \"APPEND_BEHAVIOR_PROFILE\",\n          headers: JSON_HEADERS,\n          body: JSON.stringify(completeness_data)\n        });\n      }\n    });\n    return promise;\n  }\n\n  newOuterLoopController(controller, context) {\n    var data = {\n      outer_loop_type: controller[\"type\"] || controller[\"outer_loop_type\"],\n      problem_set: controller[\"problem_set\"],\n      outer_loop_args: controller[\"args\"] || controller[\"outer_loop_args\"],\n      id: context.agent_id\n    };\n\n    console.log(this.OUTER_LOOP_URL);\n    var out = fetch(this.OUTER_LOOP_URL, {\n      method: \"NEW_STUDENT\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(data)\n    }).then(res => {});\n    console.log(out);\n    return out;\n  }\n\n  nextProblem(controller, context) {\n    var data = {\n      id: context.agent_id\n    };\n\n    var out = fetch(this.OUTER_LOOP_URL, {\n      method: \"NEXT_PROBLEM\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(data)\n    }).then(res => res.json());\n    return out;\n  }\n\n  glob(path, context) {\n    if (path[0] != \"/\") {\n      path = context.working_dir + \"/\" + path;\n    }\n    var out = fetch(this.HOST_URL, {\n      method: \"GLOB\",\n      headers: JSON_HEADERS,\n      body: JSON.stringify(path)\n    }).then(res => res.json());\n    return out;\n  }\n\n\n}\n"],"sourceRoot":""}